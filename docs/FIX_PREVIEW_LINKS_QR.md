# Превью, ссылки и QR-код не отображаются

Если в админке на странице AR-контента (список и детали заказа) не показываются превью фото, ссылка для AR-просмотра и QR-код, проверьте по шагам ниже.

## 1. Деплой последнего кода

На сервере в каталоге приложения:

```bash
cd /opt/arv/app
git pull
```

Так подтянутся:
- шаблон детали с **Alpine.store('arContentDetail')** — тогда поля «Ссылка для AR-просмотра» и QR заполняются;
- конфиг Nginx с проксированием `/storage/` и `/favicon.ico` на бэкенд.

## 2. Nginx: отдавать /storage/ и favicon через бэкенд

Чтобы не было **403** на превью и QR, запросы к файлам должны идти в приложение (оно запущено от пользователя с доступом к файлам).

Скопируйте актуальный конфиг и перезагрузите Nginx:

```bash
sudo cp /opt/arv/app/deploy/nginx/arv.conf /etc/nginx/sites-available/arv.conf
sudo nginx -t
sudo systemctl reload nginx
```

В `arv.conf` должны быть блоки:
- `location /storage/ { proxy_pass http://arv_backend; ... }`
- `location = /favicon.ico { proxy_pass http://arv_backend; ... }`

Если вместо этого используется `alias /opt/arv/storage/`, то Nginx отдаёт файлы сам и при 403 нужно выдать права:  
`sudo chmod 755 /opt/arv/storage && sudo chmod -R a+rX /opt/arv/storage`

## 3. Путь к хранилищу на сервере

В `.env` на сервере должно быть:

```env
STORAGE_BASE_PATH=/opt/arv/storage
```

Каталог должен существовать, а файлы заказов лежать внутри, например:  
`/opt/arv/storage/VertexAR/portrety/ORD-20260211-1004/thumbnail.webp`, `qr_code.png`, `video.mp4`.

## 4. Перезапуск приложения и кэш браузера

После `git pull` перезапустите приложение:

```bash
sudo systemctl restart arv
```

В браузере сделайте жёсткое обновление страницы (Ctrl+Shift+R или «Очистить кэш и обновить»), чтобы подтянуть новый шаблон и скрипты.

## Итог

| Что не работает | Причина | Что сделать |
|-----------------|--------|--------------|
| Превью (фото/видео), QR не грузятся, 403 в консоли | Nginx отдаёт `/storage/` сам и нет прав / не проксирует на бэкенд | П. 2: конфиг Nginx с proxy_pass и reload |
| Пустые поля «Ссылка для AR-просмотра» и QR на странице детали | Старый шаблон без Alpine.store | П. 1 и 4: git pull, перезапуск, жёсткое обновление страницы |
| Превью есть в БД, но путь другой | Неверный STORAGE_BASE_PATH или файлы в другом месте | П. 3: проверить .env и каталог на диске |

После выполнения шагов 1–4 превью, ссылки и QR должны отображаться.
