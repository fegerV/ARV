# AR Viewer: –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ

## –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

| –°–∏–º–ø—Ç–æ–º | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|---------|---------|---------|
| "–ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞" | –ù–µ—Ç –∫–∞–º–µ—Ä—ã –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ | –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –≤–µ–±-–∫–∞–º–µ—Ä—É |
| "–î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∑–∞–ø—Ä–µ—â—ë–Ω" | –ù–µ –¥–∞–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ | –ù–∞–∂–º–∏—Ç–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å" –≤ –±—Ä–∞—É–∑–µ—Ä–µ |
| "WebGL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω" | –û—Ç–∫–ª—é—á–µ–Ω–æ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ | –í–∫–ª—é—á–∏—Ç–µ –≤ `chrome://settings` ‚Üí –°–∏—Å—Ç–µ–º–∞ |
| –¢–∞–π–º–∞—É—Ç 3 –º–∏–Ω | –ú–µ–¥–ª–µ–Ω–Ω—ã–π –º–æ–±–∏–ª—å–Ω—ã–π GPU | –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ |
| "MINDAR: false" | –ü—Ä–æ–±–ª–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CDN | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç |
| –ü—É—Å—Ç–∞—è –æ—à–∏–±–∫–∞ `{}` | MindAR –æ—Ç–∫–ª–æ–Ω–∏–ª –±–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è | –°–º. –ª–æ–≥–∏ debug panel |

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
AR Viewer
‚îú‚îÄ‚îÄ Three.js 0.147.0 (CDN) ‚Äî 3D —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
‚îú‚îÄ‚îÄ MindAR 1.1.5 (CDN) ‚Äî Image tracking
‚îÇ   ‚îî‚îÄ‚îÄ TensorFlow.js ‚Äî WebGL backend (CPU –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è!)
‚îî‚îÄ‚îÄ .mind –º–∞—Ä–∫–µ—Ä—ã ‚Äî —Ñ–æ—Ä–º–∞—Ç MindAR
```

**–í–∞–∂–Ω–æ:** MindAR —Ç—Ä–µ–±—É–µ—Ç **WebGL backend**. CPU backend –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑-–∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è WebGL-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö API (`texData`, `gpgpu`, `compileAndRun`).

---

## –≠—Ç–∞–ø—ã –∑–∞–≥—Ä—É–∑–∫–∏

```
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ WebGL          ‚Üê –ú–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å –µ—Å–ª–∏ –Ω–µ—Ç GPU/–¥—Ä–∞–π–≤–µ—Ä–æ–≤
2. –ó–∞–≥—Ä—É–∑–∫–∞ Three.js       ‚Üê CDN
3. –ó–∞–≥—Ä—É–∑–∫–∞ MindAR         ‚Üê CDN (1.7 MB)
4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TF.js     ‚Üê –í—ã–±–æ—Ä backend
5. –ó–∞–≥—Ä—É–∑–∫–∞ .mind –º–∞—Ä–∫–µ—Ä–∞  ‚Üê Fetch —Å —Å–µ—Ä–≤–µ—Ä–∞
6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–º–µ—Ä—ã         ‚Üê getUserMedia
7. _startVideo             ‚Üê –ó–∞–ø—É—Å–∫ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞ (~1 —Å–µ–∫)
8. _startAR                ‚Üê –ö–æ–º–ø–∏–ª—è—Ü–∏—è —à–µ–π–¥–µ—Ä–æ–≤ (10 —Å–µ–∫ - 3 –º–∏–Ω!)
9. Render loop             ‚Üê AR —Ä–∞–±–æ—Ç–∞–µ—Ç
```

---

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º

–î–æ–±–∞–≤—å—Ç–µ `?diagnose=1` –∫ URL:
```
https://ar.neuroimagen.ru/view/xxx?diagnose=1
```

### –ß—Ç–µ–Ω–∏–µ –ª–æ–≥–æ–≤

```
02:08:25 LOG: WebGL info: {"ok":true,"renderer":"NVIDIA GeForce GTX 1060"}
02:08:26 LOG: TensorFlow.js backend: webgl     ‚Üê –î–æ–ª–∂–µ–Ω –±—ã—Ç—å webgl
02:08:26 LOG: MindARThree created successfully
02:08:26 LOG: Camera access granted            ‚Üê –ö–∞–º–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
02:08:30 LOG: MindAR stage: _startVideo completed in 1121 ms
02:08:31 LOG: MindAR stage: _startAR started   ‚Üê –ó–¥–µ—Å—å –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å
```

---

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ó–∞–≤–∏—Å–∞–Ω–∏–µ –Ω–∞ `_startAR` (–º–æ–±–∏–ª—å–Ω—ã–µ)

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–º–ø–∏–ª—è—Ü–∏—è WebGL —à–µ–π–¥–µ—Ä–æ–≤ TensorFlow.js –Ω–∞ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ.

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ GPU:**
- Mali-G57, Mali-G52, Mali-G76
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ Adreno —Å–µ—Ä–∏–∏
- PowerVR –Ω–∞ —Å—Ç–∞—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –∏–ª–∏ –ø–æ–¥–æ–∂–¥–∞—Ç—å –¥–æ 3-5 –º–∏–Ω—É—Ç.

### 2. "WebGL is not supported" –ø—Ä–∏ —Ä–∞–±–æ—á–µ–º WebGL

**–ü—Ä–∏—á–∏–Ω–∞:** TensorFlow.js —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (OES_texture_float).

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```
WebGL info: {ok: true}              ‚Üê –ë–∞–∑–æ–≤—ã–π WebGL —Ä–∞–±–æ—Ç–∞–µ—Ç
TensorFlow.js backend: cpu          ‚Üê TF.js —É–ø–∞–ª –Ω–∞ CPU
```

**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç—å –¥—Ä–∞–π–≤–µ—Ä—ã GPU, –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å Firefox.

### 3. –û—à–∏–±–∫–∞ `{}` (–ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç)

**–ü—Ä–∏—á–∏–Ω–∞:** MindAR v1.1.5 –≤—ã–∑—ã–≤–∞–µ—Ç `reject()` –±–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è.

**–ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å:** –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –æ—à–∏–±–∫—É.

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º

| –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ | –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|------------|------------|------------|
| –ö–æ–º–ø—å—é—Ç–µ—Ä + –≤–µ–±-–∫–∞–º–µ—Ä–∞ | ‚≠ê‚≠ê‚≠ê | –õ—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç |
| iPhone (Safari) | ‚≠ê‚≠ê‚≠ê | –†–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ |
| iPhone (Chrome) | ‚≠ê‚≠ê | Safari –ª—É—á—à–µ |
| Android (Chrome) | ‚≠ê‚≠ê | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç GPU |
| Android (Samsung Internet) | ‚≠ê‚≠ê | –ò–Ω–æ–≥–¥–∞ –ª—É—á—à–µ Chrome |

---

## CDN –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

```javascript
// Three.js ‚Äî —Å–æ–≤–º–µ—Å—Ç–∏–º —Å MindAR 1.1.5
'https://cdn.jsdelivr.net/npm/three@0.147.0/build/three.min.js'

// MindAR ‚Äî IIFE –±–∞–Ω–¥–ª (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç window.MINDAR)
'https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image-three.prod.js'
```

**–ü–æ—á–µ–º—É –Ω–µ v1.2.5?** ‚Äî –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ES –º–æ–¥—É–ª–∏, –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `<script>`.

---

## –õ–æ–∫–∞–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (fallback)

–§–∞–π–ª—ã –≤ `static/js/`:
- `three.min.js`
- `mindar-image.prod.js`
- `mindar-image-three.prod.js`

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–∏—Ç–µ URLs –≤ `ar_content.py`.

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã MindAR

| –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | TensorFlow | –§–æ—Ä–º–∞—Ç –º–∞—Ä–∫–µ—Ä–æ–≤ | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å |
|------------|------------|-----------------|---------------|
| MindAR | –î–∞ (WebGL) | .mind | –°—Ä–µ–¥–Ω—è—è |
| AR.js NFT | –ù–µ—Ç | .fset/.fset3 | –í—ã—Å–æ–∫–∞—è |
| 8th Wall | –ù–µ—Ç | –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –í—ã—Å–æ–∫–∞—è (–ø–ª–∞—Ç–Ω–æ) |

---

## –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `app/api/routes/ar_content.py` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML AR viewer |
| `static/js/*.js` | –õ–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–ø–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ |
| `scripts/legacy/build_mindar_cpu.py` | –£—Å—Ç–∞—Ä–µ–≤—à–∏–π —Å–∫—Ä–∏–ø—Ç CPU –ø–∞—Ç—á–∞ |
| `scripts/legacy/download_ar_viewer_libs.py` | –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ |

---

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 2026-02-02
- ‚ùå –£–±—Ä–∞–Ω CPU backend fallback (–Ω–µ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å MindAR)
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ CDN: Three.js 0.147.0 + MindAR 1.1.5
- ‚úÖ –†–∞–Ω–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ WebGL —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
- ‚úÖ Pre-check –∫–∞–º–µ—Ä—ã –¥–æ MindAR.start()
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —ç—Ç–∞–ø–æ–≤ `_startVideo`, `_startAR`
- ‚úÖ –¢–∞–π–º–∞—É—Ç 3 –º–∏–Ω –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö (–±—ã–ª–æ 2)
- ‚úÖ AR —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –∏ –º–æ–±–∏–ª—å–Ω—ã—Ö
- ‚úÖ –£–ª—É—á—à–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- üóëÔ∏è –£–¥–∞–ª—ë–Ω `docs/MINDAR_CPU_PATCH.md`
- üìÅ –ü–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ legacy: `build_mindar_cpu.py`, `download_ar_viewer_libs.py`
