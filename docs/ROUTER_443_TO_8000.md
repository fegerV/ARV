# Единый формат ссылок и доступ без порта

Все ссылки (админка, просмотр AR, QR-коды, приложение) берут **один базовый URL** из переменной окружения **`PUBLIC_URL`**.

- В **`.env`** задайте:
  - **С портом (как сейчас):** `PUBLIC_URL=https://ar.neuroimagen.ru:8000`  
    → админка: `https://ar.neuroimagen.ru:8000/admin/login`, ссылки и QR с `:8000`.
  - **Без порта (после настройки 443→8000):** `PUBLIC_URL=https://ar.neuroimagen.ru`  
    → админка: `https://ar.neuroimagen.ru/admin/login`, ссылки и QR без порта.

После смены `PUBLIC_URL` перезапустите сервер. В Android-приложении в `build.gradle.kts` укажите тот же базовый URL в `API_BASE_URL` (с или без `:8000`), чтобы совпадал с `PUBLIC_URL`.

---

# Настройка роутера Keenetic: проброс 443→8000

Чтобы открывать **https://ar.neuroimagen.ru** (без :8000), нужно на роутере настроить переадресацию: внешний порт **443** → ваш ПК, порт **8000**.

---

## Пошагово

1. Откройте веб-интерфейс роутера в браузере: **http://192.168.0.1**
2. В левом меню: **Сетевые правила** → **Переадресация портов**
3. Нажмите **«Добавить правило»**
4. Заполните поля **точно так**:

   | Поле | Значение | Пояснение |
   |------|----------|-----------|
   | **Включить правило** | включено (галочка) | |
   | **Описание** | `ARV HTTPS 443→8000` | для себя |
   | **Вход** | Подключение Ethernet | интерфейс, через который приходит интернет |
   | **Выход** | **Lenovo2** (или имя вашего ПК) | компьютер, где запущен сервер |
   | **Протокол** | **TCP** | |
   | **Тип правила** | Одиночный порт | |
   | **Открыть порт** | **443** | порт снаружи (на него заходят по https://ar.neuroimagen.ru) |
   | **Направлять на порт** | **8000** | порт приложения на ПК |
   | **Расписание** | Работает постоянно | |

5. Нажмите **«Сохранить»**

---

## Важно: не перепутать порты

- **Открыть порт** = **443** (не 8000) — иначе по https://ar.neuroimagen.ru браузер не попадёт на правило.
- **Направлять на порт** = **8000** (не 443) — приложение слушает порт 8000, не 443.

Если указать наоборот (8000 открыть, 443 направлять), сайт без :8000 открываться не будет.

---

## После сохранения

1. В **`.env`** задайте `PUBLIC_URL=https://ar.neuroimagen.ru` (без порта).
2. Перезапустите сервер. В Android в `API_BASE_URL` укажите `https://ar.neuroimagen.ru`.
3. Откройте в браузере **https://ar.neuroimagen.ru** (без :8000).
4. На ПК должен быть запущен сервер (uvicorn с SSL на порту 8000).
5. В брандмауэре Windows разрешите входящее **TCP 8000** (трафик с 443 приходит на ПК на порт 8000).
