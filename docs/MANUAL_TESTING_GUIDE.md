# Руководство по ручному тестированию

Подробное руководство по ручному тестированию платформы ARV.

## Подготовка к тестированию

### 1. Запуск сервера

#### Вариант A: Быстрый запуск (Windows)

```bash
quick_start.bat
```

#### Вариант B: Ручной запуск

```bash
# Установите переменные окружения
export DATABASE_URL="sqlite+aiosqlite:///./test_vertex_ar.db"
export ADMIN_EMAIL="admin@vertexar.com"
export ADMIN_DEFAULT_PASSWORD="admin123"
export DEBUG="true"
export ENVIRONMENT="development"

# Примените миграции
alembic upgrade head

# Создайте тестовые данные
python scripts/test_data/create_sample_data.py

# Запустите сервер
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

#### Вариант C: Docker

```bash
docker compose up -d
```

### 2. Проверка доступности

После запуска проверьте:

- **Главная страница**: http://localhost:8000
- **Админ-панель**: http://localhost:8000/admin
- **API документация**: http://localhost:8000/docs
- **AR Viewer**: http://localhost:8000/viewer/{ar_content_id}

### 3. Данные для входа

**По умолчанию:**
- **Email**: `admin@vertexar.com`
- **Пароль**: `admin123`

⚠️ **Важно**: Сразу после первого запуска измените пароль администратора!

## Чек-лист тестирования

### 1. Аутентификация и авторизация

#### 1.1 Вход в систему

- [ ] Откройте http://localhost:8000/admin
- [ ] Введите email: `admin@vertexar.com`
- [ ] Введите пароль: `admin123`
- [ ] Нажмите "Войти"
- [ ] Убедитесь, что открывается дашборд
- [ ] Проверьте, что в заголовке отображается email пользователя

#### 1.2 Выход из системы

- [ ] Нажмите кнопку "Выход"
- [ ] Убедитесь, что происходит редирект на страницу входа
- [ ] Попробуйте открыть защищенную страницу
- [ ] Убедитесь, что требуется повторный вход

#### 1.3 Защита от брутфорса

- [ ] Попробуйте войти с неверным паролем 5 раз
- [ ] Убедитесь, что аккаунт блокируется на 15 минут
- [ ] Проверьте сообщение о блокировке

### 2. Управление компаниями

#### 2.1 Просмотр списка компаний

- [ ] Перейдите в раздел "Компании" (`/companies`)
- [ ] Убедитесь, что список компаний отображается
- [ ] Проверьте пагинацию (если компаний много)
- [ ] Проверьте поиск по названию компании

#### 2.2 Создание компании

- [ ] Нажмите "Создать компанию"
- [ ] Заполните форму:
  - Название: "Тестовая компания"
  - Описание: "Компания для тестирования"
- [ ] Нажмите "Сохранить"
- [ ] Убедитесь, что компания появилась в списке

#### 2.3 Редактирование компании

- [ ] Откройте существующую компанию
- [ ] Измените название
- [ ] Сохраните изменения
- [ ] Убедитесь, что изменения применились

#### 2.4 Удаление компании

- [ ] Откройте компанию
- [ ] Нажмите "Удалить"
- [ ] Подтвердите удаление
- [ ] Убедитесь, что компания удалена из списка

### 3. Управление проектами

#### 3.1 Просмотр проектов

- [ ] Перейдите в раздел "Проекты" (`/projects`)
- [ ] Убедитесь, что список проектов отображается
- [ ] Проверьте фильтрацию по компаниям
- [ ] Проверьте статусы проектов (active/inactive)

#### 3.2 Создание проекта

- [ ] Нажмите "Создать проект"
- [ ] Заполните форму:
  - Компания: Выберите из списка
  - Название: "Тестовый проект"
  - Описание: "Проект для тестирования"
  - Статус: Active
- [ ] Сохраните проект
- [ ] Убедитесь, что проект появился в списке

#### 3.3 Фильтрация проектов по компании

- [ ] В форме создания AR-контента выберите компанию
- [ ] Убедитесь, что список проектов фильтруется по выбранной компании
- [ ] Проверьте, что отображаются только активные проекты выбранной компании

### 4. Управление AR-контентом

#### 4.1 Просмотр списка AR-контента

- [ ] Перейдите в раздел "AR-контент" (`/ar-content`)
- [ ] Убедитесь, что список контента отображается
- [ ] Проверьте фильтрацию по проектам и компаниям
- [ ] Проверьте статусы контента

#### 4.2 Создание AR-контента

- [ ] Нажмите "Создать AR-контент"
- [ ] Заполните форму:
  - Компания: Выберите из списка
  - Проект: Выберите из списка (должен фильтроваться по компании)
  - Имя заказчика: "Тестовый клиент"
  - Телефон: "+7 (999) 888-76-54"
  - Email: "test@example.com"
  - Длительность: 3 года
- [ ] Загрузите фото (JPEG или PNG, до 10MB)
- [ ] Загрузите видео (MP4, WebM или MOV, до 100MB)
- [ ] Нажмите "Создать AR-контент"
- [ ] Дождитесь завершения обработки (генерация маркера, превью)
- [ ] Убедитесь, что контент появился в списке

#### 4.3 Просмотр деталей AR-контента

- [ ] Откройте созданный AR-контент
- [ ] Проверьте отображение:
  - Фото заказчика
  - Видео
  - QR-код
  - Превью (thumbnail)
  - Информация о заказчике
  - Статус маркера

#### 4.4 Редактирование AR-контента

- [ ] Откройте существующий AR-контент
- [ ] Нажмите "Редактировать"
- [ ] Измените данные заказчика
- [ ] Сохраните изменения
- [ ] Убедитесь, что изменения применились

#### 4.5 Удаление AR-контента

- [ ] Откройте AR-контент
- [ ] Нажмите "Удалить"
- [ ] Подтвердите удаление
- [ ] Убедитесь, что контент удален

### 5. Генерация маркеров

#### 5.1 Проверка генерации маркера

- [ ] Создайте новый AR-контент с изображением
- [ ] Дождитесь завершения обработки
- [ ] Откройте детали контента
- [ ] Проверьте статус маркера:
  - `ready`: Маркер валиден
  - `ready_with_warnings`: Есть предупреждения
  - `ready_invalid`: Маркер не содержит features
- [ ] Проверьте количество features (должно быть > 0 для работы)

#### 5.2 Проверка качества маркера

- [ ] Используйте изображение с высоким контрастом
- [ ] Создайте AR-контент
- [ ] Проверьте, что количество features > 50 (для надежного трекинга)
- [ ] Проверьте предупреждения валидации

### 6. AR Viewer

#### 6.1 Открытие AR Viewer

- [ ] Откройте детали AR-контента
- [ ] Нажмите "Открыть в AR Viewer" или перейдите по прямой ссылке
- [ ] Убедитесь, что открывается AR viewer

#### 6.2 Тестирование AR трекинга

- [ ] Откройте AR viewer на мобильном устройстве
- [ ] Наведите камеру на изображение (фото заказчика)
- [ ] Убедитесь, что видео воспроизводится поверх изображения
- [ ] Проверьте стабильность трекинга
- [ ] Проверьте переключение видео (если настроено расписание)

### 7. Расписание видео

#### 7.1 Настройка расписания

- [ ] Откройте AR-контент с несколькими видео
- [ ] Настройте расписание:
  - Режим: последовательный, циклический или ручной
  - Время переключения (для последовательного)
- [ ] Сохраните настройки

#### 7.2 Проверка работы расписания

- [ ] Откройте AR viewer
- [ ] Проверьте переключение видео согласно расписанию
- [ ] Убедитесь, что видео переключаются в правильном порядке

### 8. Уведомления

#### 8.1 Просмотр уведомлений

- [ ] Перейдите в раздел "Уведомления" (`/notifications`)
- [ ] Убедитесь, что список уведомлений отображается
- [ ] Проверьте фильтрацию по статусу (прочитано/непрочитано)

#### 8.2 Отметка уведомлений как прочитанных

- [ ] Откройте непрочитанное уведомление
- [ ] Убедитесь, что оно помечается как прочитанное
- [ ] Проверьте счетчик непрочитанных уведомлений

### 9. API тестирование

#### 9.1 Получение токена

```bash
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=admin@vertexar.com&password=admin123"
```

- [ ] Проверьте, что возвращается токен
- [ ] Сохраните токен для следующих запросов

#### 9.2 Получение списка компаний

```bash
curl -X GET http://localhost:8000/api/companies/ \
  -H "Authorization: Bearer <your-token>"
```

- [ ] Проверьте, что возвращается список компаний
- [ ] Проверьте структуру ответа

#### 9.3 Создание AR-контента через API

```bash
curl -X POST http://localhost:8000/api/ar-content/ \
  -H "Authorization: Bearer <your-token>" \
  -F "company_id=1" \
  -F "project_id=1" \
  -F "customer_name=Test Client" \
  -F "duration_years=3" \
  -F "photo=@test_data/valid_test_image.png" \
  -F "video=@test_data/test_video.mp4"
```

- [ ] Проверьте, что контент создается
- [ ] Проверьте статус ответа
- [ ] Проверьте, что маркер генерируется

### 10. Тестирование производительности

#### 10.1 Загрузка больших файлов

- [ ] Загрузите фото размером ~10MB
- [ ] Загрузите видео размером ~100MB
- [ ] Убедитесь, что загрузка завершается успешно
- [ ] Проверьте время обработки

#### 10.2 Множественные запросы

- [ ] Создайте несколько AR-контентов подряд
- [ ] Убедитесь, что система обрабатывает все запросы
- [ ] Проверьте отсутствие ошибок

### 11. Тестирование безопасности

#### 11.1 Защита от неавторизованного доступа

- [ ] Попробуйте открыть защищенную страницу без авторизации
- [ ] Убедитесь, что происходит редирект на страницу входа

#### 11.2 Валидация входных данных

- [ ] Попробуйте создать AR-контент без обязательных полей
- [ ] Убедитесь, что показываются ошибки валидации
- [ ] Попробуйте загрузить файл неподдерживаемого формата
- [ ] Убедитесь, что показывается ошибка

#### 11.3 Защита от XSS

- [ ] Попробуйте ввести HTML/JavaScript в текстовые поля
- [ ] Убедитесь, что код экранируется и не выполняется

## Создание тестовых данных

### Автоматическое создание

```bash
# Создание полного набора тестовых данных
python scripts/test_data/create_sample_data.py
```

### Ручное создание через скрипты

```bash
# Создание администратора
python utilities/create_admin.py

# Создание тестового проекта
python utilities/create_test_project.py

# Создание тестового AR-контента
python scripts/legacy/create_test_ar_content.py
```

## Проверка системы

### Скрипты проверки

```bash
# Проверка базы данных
python utilities/check_db.py

# Проверка пользователей и аутентификации
python utilities/check_users_and_auth.py

# Проверка миграций
python utilities/check_migration.py

# Проверка соответствия моделей и БД
python scripts/checks/check_models_db_compliance.py
```

## Типичные проблемы при тестировании

### Проблема: Не могу войти

**Решение:**
1. Проверьте данные для входа
2. Проверьте, что пользователь создан: `python utilities/check_admin.py`
3. Сбросьте пароль: `python utilities/fix_admin_password.py`

### Проблема: Маркер не генерируется

**Решение:**
1. Проверьте, что установлены Node.js зависимости: `npm install`
2. Проверьте логи приложения
3. Используйте изображение с хорошим контрастом

### Проблема: Файлы не загружаются

**Решение:**
1. Проверьте размер файлов (фото < 10MB, видео < 100MB)
2. Проверьте формат файлов
3. Проверьте права доступа к директории storage

### Проблема: AR viewer не работает

**Решение:**
1. Проверьте, что маркер сгенерирован и валиден
2. Используйте HTTPS или localhost (необходимо для доступа к камере)
3. Проверьте консоль браузера на ошибки

## Отчет о тестировании

После завершения тестирования заполните отчет:

- ✅ Пройдено успешно
- ⚠️ Пройдено с предупреждениями
- ❌ Не пройдено (с описанием проблемы)

Сохраните отчет для дальнейшего анализа и исправления проблем.
