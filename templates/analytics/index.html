{% extends "base.html" %}

{% block title %}Analytics - Vertex AR Admin{% endblock %}
{% block page_title %}Analytics{% endblock %}

{% block content %}
<div x-data="analyticsPage()">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400 mr-4">
                    <span class="material-icons">visibility</span>
                </div>
                <div>
                    <p class="text-gray-500 dark:text-gray-400">Total Views</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ analytics_data.total_views|default('—') }}</p>
                </div>
            </div>
        
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400 mr-4">
                    <span class="material-icons">people</span>
                </div>
                <div>
                    <p class="text-gray-500 dark:text-gray-400">Unique Sessions</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ analytics_data.unique_sessions|default('—') }}</p>
                </div>
            </div>
        
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-purple-100 text-purple-600 dark:bg-purple-900/30 dark:text-purple-40 mr-4">
                    <span class="material-icons">view_in_ar</span>
                </div>
                <div>
                    <p class="text-gray-500 dark:text-gray-400">Active Content</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ analytics_data.active_content|default('—') }}</p>
                </div>
            </div>
        
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400 mr-4">
                    <span class="material-icons">timer</span>
                </div>
                <div>
                    <p class="text-gray-500 dark:text-gray-400">Avg. Session Duration</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ analytics_data.avg_session_duration|default('—') }}</p>
                </div>
            </div>
        </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
            <h3 class="text-lg font-semibold mb-4 dark:text-white">Views Over Time</h3>
            <div class="h-64">
                <canvas id="viewsChart"></canvas>
            </div>
        
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
            <h3 class="text-lg font-semibold mb-4 dark:text-white">Top AR Content</h3>
            <div class="space-y-4">
                {% for content in analytics_data.top_content %}
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-700 dark:text-gray-300 font-medium">{{ content.title }}</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">{{ content.company_name }}</p>
                    </div>
                    <span class="text-lg font-semibold text-gray-900 dark:text-white">{{ content.views_count }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow mb-6">
        <h3 class="text-lg font-semibold mb-4 dark:text-white">Date Range</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Start Date</label>
                <input type="date" 
                       class="mt-1 block w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 py-2 px-3 shadow-sm focus:outline-none focus:ring-indigo-50 focus:border-indigo-500 sm:text-sm dark:text-white"
                       x-model="dateRange.start">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">End Date</label>
                <input type="date" 
                       class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 py-2 px-3 shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm dark:text-white"
                       x-model="dateRange.end">
            </div>
            <div class="flex items-end">
                <button @click="updateAnalytics" 
                        class="w-full bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                    Update
                </button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function analyticsPage() {
    return {
        dateRange: {
            start: '{{ date_range.start if date_range else "" }}',
            end: '{{ date_range.end if date_range else "" }}'
        },
        
        init() {
            this.initCharts();
        },
        
        initCharts() {
            // Initialize views chart
            const ctx = document.getElementById('viewsChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'Views',
                        data: [12, 19, 3, 5, 2, 3, 8, 12, 15, 10, 7, 9],
                        borderColor: 'rgb(79, 70, 229)',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        },
        
        updateAnalytics() {
            // Update analytics with new date range
            const params = new URLSearchParams();
            if (this.dateRange.start) params.append('start_date', this.dateRange.start);
            if (this.dateRange.end) params.append('end_date', this.dateRange.end);
            
            window.location.search = params.toString();
        }
    };
}
</script>
{% endblock %}