{% extends "base.html" %}

{% block title %}Справка - Vertex AR Admin{% endblock %}
{% block page_title %}Справка{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 pb-16">
    <p class="text-gray-500 dark:text-gray-400 mb-6">
        Полная документация по платформе Vertex AR: от первого входа до публикации AR-контента, настройки компаний, аналитики и обслуживания.
    </p>

    {# ── Содержание ───────────────────────────────────────────────────── #}
    <nav class="mb-10 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-xl border border-gray-200 dark:border-gray-700">
        <h2 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Содержание</h2>
        <ul class="space-y-1.5 text-sm columns-1 sm:columns-2 gap-4">
            <li><a href="#intro" class="text-indigo-600 dark:text-indigo-400 hover:underline">Введение</a></li>
            <li><a href="#how-it-works" class="text-indigo-600 dark:text-indigo-400 hover:underline">Как работает платформа</a></li>
            <li><a href="#getting-started" class="text-indigo-600 dark:text-indigo-400 hover:underline">С чего начать</a></li>
            <li><a href="#dashboard" class="text-indigo-600 dark:text-indigo-400 hover:underline">Главная (дашборд)</a></li>
            <li><a href="#companies" class="text-indigo-600 dark:text-indigo-400 hover:underline">Раздел «Компании»</a></li>
            <li><a href="#projects" class="text-indigo-600 dark:text-indigo-400 hover:underline">Раздел «Проекты»</a></li>
            <li><a href="#ar-content" class="text-indigo-600 dark:text-indigo-400 hover:underline">Раздел «AR-контент»</a></li>
            <li><a href="#storage" class="text-indigo-600 dark:text-indigo-400 hover:underline">Раздел «Хранилище»</a></li>
            <li><a href="#analytics" class="text-indigo-600 dark:text-indigo-400 hover:underline">Раздел «Аналитика»</a></li>
            <li><a href="#notifications" class="text-indigo-600 dark:text-indigo-400 hover:underline">Раздел «Уведомления»</a></li>
            <li><a href="#settings" class="text-indigo-600 dark:text-indigo-400 hover:underline">Раздел «Настройки»</a></li>
            <li><a href="#tips" class="text-indigo-600 dark:text-indigo-400 hover:underline">Советы по маркерам и видео</a></li>
            <li><a href="#faq" class="text-indigo-600 dark:text-indigo-400 hover:underline">Частые вопросы (FAQ)</a></li>
            <li><a href="#contacts" class="text-indigo-600 dark:text-indigo-400 hover:underline">Контакты</a></li>
        </ul>
    </nav>

    {# ── Введение ─────────────────────────────────────────────────────── #}
    <section id="intro" class="mb-10">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-indigo-500">info</span>
            Введение
        </h2>
        <div class="prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 space-y-3">
            <p>
                <strong>Vertex AR</strong> — платформа для создания и раздачи AR-контента (дополненной реальности). Администратор загружает в веб-интерфейс изображение-маркер и видео; система выдаёт ссылку и QR-код. Конечный пользователь открывает ссылку в мобильном приложении <strong>Portal AR</strong>, наводит камеру на распечатанный маркер — и поверх изображения воспроизводится видео.
            </p>
            <p>
                Платформа подходит для рекламы, образовательных материалов, визиток, упаковки: везде, где нужно «оживить» печатное изображение с помощью видео в AR.
            </p>
        </div>
    </section>

    {# ── Как работает платформа ───────────────────────────────────────── #}
    <section id="how-it-works" class="mb-10">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-indigo-500">architecture</span>
            Как работает платформа
        </h2>
        <div class="prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 space-y-3">
            <p>
                <strong>Иерархия данных:</strong> Компании → Проекты → AR-контент. Одна компания объединяет проекты (например, по заказчикам или кампаниям). В каждом проекте — список единиц AR-контента (заказов). У каждой единицы есть: фото маркера, одно или несколько видео, статус, ссылка для просмотра и QR-код.
            </p>
            <p>
                <strong>Хранение:</strong> Файлы (маркеры, видео) по умолчанию хранятся на сервере платформы. Для компании можно включить хранение на <strong>Яндекс.Диске</strong> — тогда файлы этой компании будут загружаться в указанную папку на Диске.
            </p>
            <p>
                <strong>Просмотр:</strong> Пользователь переходит по ссылке вида <code class="text-sm bg-gray-100 dark:bg-gray-700 px-1 rounded">https://ar.neuroimagen.ru/view/&lt;id&gt;</code> или сканирует QR-код. Приложение Portal AR (Android) загружает манифест и медиафайлы, затем при наведении камеры на маркер отображает видео поверх изображения (на базе ARCore и распознавания изображений).
            </p>
            <p>
                <strong>Ротация видео:</strong> У одного AR-контента может быть несколько видео. В настройках заказа можно включить ротацию: система по расписанию или случайному правилу подставляет «активное» видео, так что контент можно обновлять без смены ссылки и QR.
            </p>
        </div>
    </section>

    {# ── С чего начать ────────────────────────────────────────────────── #}
    <section id="getting-started" class="mb-10">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-green-500">play_circle</span>
            С чего начать
        </h2>
        <ol class="list-decimal list-inside space-y-3 text-gray-700 dark:text-gray-300">
            <li><strong>Войдите в админку</strong> по адресу <code class="text-sm bg-gray-100 dark:bg-gray-700 px-1 rounded">/admin/login</code>. Используйте учётные данные, выданные администратором платформы.</li>
            <li><strong>Создайте компанию</strong> (меню «Компании» → кнопка «Создать»). Укажите название; при необходимости выберите хранение на Яндекс.Диске и введите OAuth-токен (получается через настройки приложения в Яндекс.Диске). Сохраните.</li>
            <li><strong>Создайте проект</strong> в этой компании (меню «Проекты» → «Создать»). Выберите компанию, введите название и при необходимости описание. Проект нужен для группировки AR-контента (один проект — одна кампания или один заказчик).</li>
            <li><strong>Добавьте AR-контент</strong> (меню «AR-контент» → «Создать»). Выберите компанию и проект, укажите номер заказа и данные заказчика, загрузите фото маркера и хотя бы одно видео. После сохранения система сгенерирует AR-маркер, уникальную ссылку и QR-код.</li>
            <li><strong>Скачайте и распечатайте</strong> маркер и QR-код со страницы контента. Раздайте материалы клиентам. Они открывают ссылку в приложении Portal AR и наводят камеру на маркер для просмотра видео в AR.</li>
        </ol>
    </section>

    {# ── Главная (дашборд) ────────────────────────────────────────────── #}
    <section id="dashboard" class="mb-10">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-blue-500">dashboard</span>
            Главная (дашборд)
        </h2>
        <div class="space-y-3 text-gray-700 dark:text-gray-300">
            <p>По адресу <code class="text-sm bg-gray-100 dark:bg-gray-700 px-1 rounded">/admin</code> отображается сводная страница:</p>
            <ul class="list-disc list-inside space-y-1">
                <li><strong>Карточки статистики:</strong> количество компаний (и активных), проектов, единиц AR-контента, всего просмотров и просмотров за 30 дней. По клику на карточку — переход в соответствующий раздел.</li>
                <li><strong>Быстрые действия:</strong> ссылки на создание компании, проекта, AR-контента, переход в аналитику, управление хранилищем и уведомлениями.</li>
                <li><strong>Недавний AR-контент:</strong> список последних записей с переходом к карточке контента.</li>
            </ul>
        </div>
    </section>

    {# ── Компании ─────────────────────────────────────────────────────── #}
    <section id="companies" class="mb-10">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-blue-500">business</span>
            Раздел «Компании»
        </h2>
        <div class="space-y-3 text-gray-700 dark:text-gray-300">
            <p><strong>Список компаний</strong> (<code class="text-sm bg-gray-100 dark:bg-gray-700 px-1 rounded">/companies</code>): таблица всех компаний с названием, статусом, контактами. Можно перейти к созданию новой компании или к просмотру/редактированию существующей.</p>
            <p><strong>Создание и редактирование:</strong></p>
            <ul class="list-disc list-inside space-y-1">
                <li>Название, контактный email, описание.</li>
                <li>Статус: активная / неактивная. Неактивные компании не используются в выборах при создании проектов и AR-контента.</li>
                <li><strong>Хранение:</strong> по умолчанию — «локальное» (файлы на сервере платформы). Можно переключить на «Яндекс.Диск» и указать OAuth-токен и путь к папке на Диске. Токен получается в настройках приложения в Яндекс OAuth; срок действия ограничен, его нужно периодически обновлять.</li>
            </ul>
            <p>После сохранения компания появляется в выпадающих списках при создании проектов и AR-контента.</p>
        </div>
    </section>

    {# ── Проекты ──────────────────────────────────────────────────────── #}
    <section id="projects" class="mb-10">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-green-500">folder</span>
            Раздел «Проекты»
        </h2>
        <div class="space-y-3 text-gray-700 dark:text-gray-300">
            <p><strong>Список проектов</strong> (<code class="text-sm bg-gray-100 dark:bg-gray-700 px-1 rounded">/projects</code>): фильтр по компании, таблица проектов с названием, компанией, датами. Кнопки «Создать», «Открыть», «Редактировать».</p>
            <p><strong>Создание и редактирование:</strong> выбор компании (обязательно), название проекта, описание. Проект привязан к одной компании. Внутри проекта затем создаётся AR-контент (заказы).</p>
            <p>Проекты нужны для логической группировки: один проект может соответствовать одной рекламной кампании, одному заказчику или одному тиражу материалов.</p>
        </div>
    </section>

    {# ── AR-контент ──────────────────────────────────────────────────── #}
    <section id="ar-content" class="mb-10">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-purple-500">view_in_ar</span>
            Раздел «AR-контент»
        </h2>
        <div class="space-y-4 text-gray-700 dark:text-gray-300">
            <p><strong>Список</strong> (<code class="text-sm bg-gray-100 dark:bg-gray-700 px-1 rounded">/ar-content</code>): фильтры по компании, проекту, поиск по номеру заказа. Таблица с заказом, компанией, просмотрами, сессиями, средней длительностью, долей просмотра видео. Кнопки «Создать», «Открыть» (переход к карточке контента).</p>

            <h3 class="text-lg font-medium text-gray-900 dark:text-white mt-4">Создание и редактирование AR-контента</h3>
            <ul class="list-disc list-inside space-y-1">
                <li><strong>Компания и проект:</strong> обязательные поля; от них зависит, куда сохраняются файлы (локально или на Яндекс.Диск компании).</li>
                <li><strong>Номер заказа, заказчик:</strong> идентификация контента для вашего учёта.</li>
                <li><strong>Фото маркера:</strong> изображение, на которое пользователь наводит камеру. Рекомендуется чёткое, контрастное фото с деталями; после загрузки система может показать метрики качества и рекомендации. Поддерживаются распространённые форматы (JPEG, PNG и т.д.).</li>
                <li><strong>Видео:</strong> одно или несколько. Форматы MP4, WebM. Первое загруженное видео по умолчанию отображается в AR. Если видео несколько, можно настроить ротацию (см. ниже).</li>
            </ul>

            <h3 class="text-lg font-medium text-gray-900 dark:text-white mt-4">Ротация видео</h3>
            <p>В карточке AR-контента (страница просмотра/редактирования) можно настроить расписание смены видео: по времени (например, каждые N часов) или по типу ротации. Активное в данный момент видео отдаётся приложению при запросе; смена происходит автоматически по правилам. Ссылка и QR-код при этом не меняются.</p>

            <h3 class="text-lg font-medium text-gray-900 dark:text-white mt-4">Статусы</h3>
            <p>У контента может быть статус: черновик, в обработке, готов, активен и т.д. От статуса может зависеть видимость для просмотра (например, только «активный» контент отдаётся в приложение). Точный список статусов и их влияние отображаются в интерфейсе.</p>

            <h3 class="text-lg font-medium text-gray-900 dark:text-white mt-4">Ссылка и QR-код</h3>
            <p>После сохранения контента система генерирует постоянную ссылку вида <code class="text-sm bg-gray-100 dark:bg-gray-700 px-1 rounded">https://ar.neuroimagen.ru/view/&lt;unique_id&gt;</code>. На странице контента можно скопировать ссылку и скачать QR-код для печати. Один и тот же QR/ссылка всегда ведут на этот контент; при смене видео через ротацию ссылка остаётся той же.</p>
        </div>
    </section>

    {# ── Хранилище ────────────────────────────────────────────────────── #}
    <section id="storage" class="mb-10">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-amber-500">storage</span>
            Раздел «Хранилище»
        </h2>
        <div class="space-y-3 text-gray-700 dark:text-gray-300">
            <p>Страница <code class="text-sm bg-gray-100 dark:bg-gray-700 px-1 rounded">/storage</code> показывает использование хранилища по компаниям: объём занятого места (локально и/или на Яндекс.Диске, в зависимости от настроек компаний). Здесь можно оценить, сколько места занимают маркеры и видео, и при необходимости очистить или перенести данные. Детали структуры папок и файлов зависят от конфигурации (локальное хранилище платформы или папки на Диске).</p>
        </div>
    </section>

    {# ── Аналитика ───────────────────────────────────────────────────── #}
    <section id="analytics" class="mb-10">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-green-500">analytics</span>
            Раздел «Аналитика»
        </h2>
        <div class="space-y-3 text-gray-700 dark:text-gray-300">
            <p>Страница <code class="text-sm bg-gray-100 dark:bg-gray-700 px-1 rounded">/analytics</code> выводит сводную статистику просмотров AR-контента.</p>
            <ul class="list-disc list-inside space-y-1">
                <li><strong>Фильтр периода:</strong> 7, 30, 90 дней или «Всё время».</li>
                <li><strong>Карточки:</strong> всего просмотров, уникальных сессий, активный контент, средняя длительность сессии, доля просмотра видео, всего единиц контента.</li>
                <li><strong>Графики:</strong> просмотры по дням, распределение по устройствам и браузерам, топ контента по просмотрам.</li>
                <li><strong>Таблица по компаниям:</strong> заказы, компании, просмотры, сессии, средняя длительность, доля видео. Удобно для отчётов по заказчикам.</li>
            </ul>
        </div>
    </section>

    {# ── Уведомления ─────────────────────────────────────────────────── #}
    <section id="notifications" class="mb-10">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-red-500">notifications</span>
            Раздел «Уведомления»
        </h2>
        <div class="space-y-3 text-gray-700 dark:text-gray-300">
            <p>Страница <code class="text-sm bg-gray-100 dark:bg-gray-700 px-1 rounded">/notifications</code> — лента системных уведомлений: информационные сообщения, предупреждения и критические алерты (например, сбои сервиса, проблемы с хранилищем). Уведомления можно просматривать постранично; при клике на запись открывается детальный просмотр. Настройка каналов доставки (Email, Telegram) выполняется в разделе «Настройки» → вкладка «Уведомления».</p>
        </div>
    </section>

    {# ── Настройки ───────────────────────────────────────────────────── #}
    <section id="settings" class="mb-10">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-gray-500">settings</span>
            Раздел «Настройки»
        </h2>
        <div class="space-y-4 text-gray-700 dark:text-gray-300">
            <p>Страница <code class="text-sm bg-gray-100 dark:bg-gray-700 px-1 rounded">/settings</code> содержит несколько вкладок:</p>
            <ul class="list-disc list-inside space-y-1">
                <li><strong>Общие:</strong> название сайта, базовый URL и прочие параметры отображения платформы.</li>
                <li><strong>Безопасность:</strong> смена пароля, настройки сессий (если доступны).</li>
                <li><strong>AR:</strong> параметры, связанные с генерацией маркеров и поведением AR (при наличии таких опций).</li>
                <li><strong>Уведомления:</strong> настройка SMTP для email-уведомлений; настройка Telegram-бота (токен бота, ID чата). После сохранения можно отправить тестовое сообщение в Telegram, чтобы проверить доставку. Критические алерты платформы приходят в указанный чат.</li>
                <li><strong>Хранилище:</strong> глобальные параметры путей и лимитов хранилища (если применимо).</li>
                <li><strong>Бэкапы:</strong> расписание автоматического бэкапа базы данных (PostgreSQL), настройка выгрузки на Яндекс.Диск, ротация копий. Можно запустить ручной бэкап кнопкой «Запустить бэкап».</li>
            </ul>
            <p><strong>Режим обслуживания:</strong> в общих или отдельных настройках можно включить «режим обслуживания». Тогда публичные страницы просмотра AR (по ссылке /view/...) будут возвращать сообщение вроде «Платформа на обслуживании». Вход в админку и работа в разделах компаний, проектов, AR-контента, настроек остаётся доступной для администраторов.</p>
        </div>
    </section>

    {# ── Советы по маркерам и видео ──────────────────────────────────── #}
    <section id="tips" class="mb-10">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-amber-500">lightbulb</span>
            Советы по маркерам и видео
        </h2>
        <ul class="space-y-2 text-gray-700 dark:text-gray-300">
            <li>• Используйте фото маркера с <strong>чёткими границами и контрастом</strong>. Размытые или однотонные изображения распознаются хуже.</li>
            <li>• Снимайте маркер при хорошем освещении; избегайте бликов и сильных теней.</li>
            <li>• Маркер должен быть на ровной поверхности; пользователь держит телефон на расстоянии примерно 20–40 см от маркера.</li>
            <li>• Печатайте маркер в достаточном размере (например, не меньше 5×5 см), чтобы камера могла стабильно захватить изображение.</li>
            <li>• Видео сжимайте до разумного размера и длительности — так быстрее загрузка в мобильном приложении и меньше расход трафика.</li>
            <li>• Если приложение пишет «изображение маркера не подходит» — загрузите другое фото с большим количеством деталей и контрастом; при необходимости переснимите или перепечатайте маркер.</li>
            <li>• Для стабильной работы AR на устройстве пользователя должен быть установлен и поддерживаться ARCore (список совместимых устройств — на сайте Google).</li>
        </ul>
    </section>

    {# ── FAQ ──────────────────────────────────────────────────────────── #}
    <section id="faq" class="mb-10">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-blue-500">help</span>
            Частые вопросы (FAQ)
        </h2>
        <div class="space-y-6">
            <div class="border-l-4 border-indigo-500 pl-4">
                <h3 class="font-medium text-gray-900 dark:text-white">Как пользователь открывает AR?</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">По ссылке из QR-кода или введённой вручную в браузере. Для просмотра в AR нужно приложение Portal AR (Android). После перехода по ссылке приложение открывается (или предлагает установить), загружает контент; затем пользователь наводит камеру на распечатанный маркер — видео воспроизводится поверх изображения.</p>
            </div>
            <div class="border-l-4 border-indigo-500 pl-4">
                <h3 class="font-medium text-gray-900 dark:text-white">Почему AR не запускается на телефоне?</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Устройство должно поддерживать ARCore (проверьте список на сайте Google). Если приложение сообщает «изображение маркера не подходит» — замените фото маркера на более контрастное и детализированное или перепечатайте маркер в лучшем качестве.</p>
            </div>
            <div class="border-l-4 border-indigo-500 pl-4">
                <h3 class="font-medium text-gray-900 dark:text-white">Где хранятся файлы?</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">По умолчанию — на сервере платформы в каталогах хранилища. Для компании можно включить хранение на Яндекс.Диске: в карточке компании выберите провайдер «Яндекс.Диск», укажите OAuth-токен и путь к папке. Файлы этой компании тогда сохраняются на Диске.</p>
            </div>
            <div class="border-l-4 border-indigo-500 pl-4">
                <h3 class="font-medium text-gray-900 dark:text-white">Как обновить видео без смены ссылки и QR?</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Добавьте несколько видео в один AR-контент и настройте ротацию (в карточке контента — раздел расписания/ротации). Система будет подставлять «активное» видео по расписанию или правилу; ссылка и QR остаются прежними.</p>
            </div>
            <div class="border-l-4 border-indigo-500 pl-4">
                <h3 class="font-medium text-gray-900 dark:text-white">Что такое «режим обслуживания»?</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">В настройках можно включить режим обслуживания. Публичные страницы просмотра AR тогда показывают сообщение «Платформа на обслуживании». Вход в админку и работа в разделах (компании, проекты, AR-контент, настройки) по-прежнему доступны.</p>
            </div>
            <div class="border-l-4 border-indigo-500 pl-4">
                <h3 class="font-medium text-gray-900 dark:text-white">Куда приходят уведомления?</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">В «Настройки» → «Уведомления» настраиваются каналы: Email (SMTP) и Telegram (токен бота и ID чата). После сохранения можно отправить тестовое сообщение в Telegram. Критические алерты (проблемы со здоровьем сервиса, сбои) приходят в указанный чат и при необходимости по email.</p>
            </div>
            <div class="border-l-4 border-indigo-500 pl-4">
                <h3 class="font-medium text-gray-900 dark:text-white">Как сделать бэкап базы?</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">В «Настройки» → вкладка «Бэкапы» настраивается расписание автоматического бэкапа и выгрузка на Яндекс.Диск. Кнопка «Запустить бэкап» выполняет ручной бэкап по текущим настройкам.</p>
            </div>
        </div>
    </section>

    {# ── Контакты ────────────────────────────────────────────────────── #}
    <section id="contacts" class="mb-10">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-gray-500">contact_support</span>
            Контакты
        </h2>
        <p class="text-gray-700 dark:text-gray-300">
            По вопросам работы платформы Vertex AR: <a href="mailto:support@neuroimagen.ru" class="text-indigo-600 dark:text-indigo-400 hover:underline">support@neuroimagen.ru</a>
        </p>
    </section>
</div>
{% endblock %}
