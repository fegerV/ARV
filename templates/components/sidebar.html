<!-- Mobile overlay -->
<div x-data="sidebarMobile()" 
     x-show="open" 
     x-cloak
     @click="open = false" 
     class="fixed inset-0 bg-black/50 z-40 lg:hidden"
     x-transition:enter="transition-opacity ease-out duration-300"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition-opacity ease-in duration-200"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0">
</div>

<!-- Sidebar -->
<div x-data="sidebarMobile()" 
     id="sidebar" 
     class="fixed top-0 left-0 h-screen bg-gray-800 dark:bg-gray-800 text-white w-64 z-50 transition-transform duration-300 lg:translate-x-0"
     :class="open ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'">
    
    <div class="p-4 border-b border-gray-700 dark:border-gray-700 flex items-center justify-between">
        <h1 class="text-xl font-bold">Vertex AR</h1>
        <!-- Close button for mobile -->
        <button @click="open = false" class="lg:hidden p-1 rounded hover:bg-gray-700">
            <span class="material-icons">close</span>
        </button>
    </div>
    
    <div class="p-2 overflow-y-auto" style="height: calc(100vh - 65px);">
        <ul class="space-y-1">
            <li>
                <a href="/admin" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/admin')}" @click="closeMobile()">
                    <span class="material-icons mr-3">dashboard</span>
                    <span class="sidebar-text">Dashboard</span>
                </a>
            </li>
            <li>
                <a href="/companies" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/companies')}" @click="closeMobile()">
                    <span class="material-icons mr-3">business</span>
                    <span class="sidebar-text">Companies</span>
                </a>
            </li>
            <li>
                <a href="/projects" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/projects')}" @click="closeMobile()">
                    <span class="material-icons mr-3">folder</span>
                    <span class="sidebar-text">Projects</span>
                </a>
            </li>
            <li>
                <a href="/ar-content" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/ar-content')}" @click="closeMobile()">
                    <span class="material-icons mr-3">view_in_ar</span>
                    <span class="sidebar-text">AR Content</span>
                </a>
            </li>
            <li>
                <a href="/storage" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/storage')}" @click="closeMobile()">
                    <span class="material-icons mr-3">storage</span>
                    <span class="sidebar-text">Storage</span>
                </a>
            </li>
            <li>
                <a href="/analytics" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/analytics')}" @click="closeMobile()">
                    <span class="material-icons mr-3">analytics</span>
                    <span class="sidebar-text">Analytics</span>
                </a>
            </li>
            <li>
                <a href="/notifications" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/notifications')}" @click="closeMobile()">
                    <span class="material-icons mr-3">notifications</span>
                    <span class="sidebar-text">Notifications</span>
                </a>
            </li>
            <li>
                <a href="/settings" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/settings')}" @click="closeMobile()">
                    <span class="material-icons mr-3">settings</span>
                    <span class="sidebar-text">Settings</span>
                </a>
            </li>
        </ul>
    </div>
</div>

<script>
    function sidebarMobile() {
        return {
            open: false,
            
            init() {
                // Listen for toggle event from header
                window.addEventListener('toggle-sidebar', () => {
                    this.open = !this.open;
                });
            },
            
            closeMobile() {
                if (window.innerWidth < 1024) {
                    this.open = false;
                }
            },
            
            isActive(route) {
                return window.location.pathname === route || window.location.pathname.startsWith(route + '/');
            }
        }
    }
</script>