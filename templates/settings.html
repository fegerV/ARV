{% extends "base.html" %}

{% block title %}Settings - Vertex AR Admin{% endblock %}

{% block page_title %}Settings{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Success/Error Messages -->
    {% if success_message %}
    <div class="mb-6 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg">
        <div class="flex items-center">
            <span class="material-icons text-green-600 dark:text-green-400 mr-2">check_circle</span>
            <span class="text-green-800 dark:text-green-200">{{ success_message }}</span>
        </div>
    </div>
    {% endif %}
    
    {% if error_message %}
    <div class="mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
        <div class="flex items-center">
            <span class="material-icons text-red-600 dark:text-red-400 mr-2">error</span>
            <span class="text-red-800 dark:text-red-200">{{ error_message }}</span>
        </div>
    </div>
    {% endif %}

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
        <!-- Settings Navigation -->
        <div class="lg:col-span-1">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                <nav class="p-2">
                    <a href="#general" class="nav-link flex items-center px-3 py-2 text-sm font-medium rounded-md {% if active_section == 'general' %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %} transition-colors">
                        <span class="material-icons text-lg mr-2">settings</span>
                        General
                    </a>
                    <a href="#security" class="nav-link flex items-center px-3 py-2 text-sm font-medium rounded-md {% if active_section == 'security' %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %} transition-colors">
                        <span class="material-icons text-lg mr-2">security</span>
                        Security
                    </a>
                    <a href="#storage" class="nav-link flex items-center px-3 py-2 text-sm font-medium rounded-md {% if active_section == 'storage' %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %} transition-colors">
                        <span class="material-icons text-lg mr-2">storage</span>
                        Storage
                    </a>
                    <a href="#notifications" class="nav-link flex items-center px-3 py-2 text-sm font-medium rounded-md {% if active_section == 'notifications' %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %} transition-colors">
                        <span class="material-icons text-lg mr-2">notifications</span>
                        Notifications
                    </a>
                    <a href="#api" class="nav-link flex items-center px-3 py-2 text-sm font-medium rounded-md {% if active_section == 'api' %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %} transition-colors">
                        <span class="material-icons text-lg mr-2">api</span>
                        API
                    </a>
                    <a href="#integrations" class="nav-link flex items-center px-3 py-2 text-sm font-medium rounded-md {% if active_section == 'integrations' %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %} transition-colors">
                        <span class="material-icons text-lg mr-2">integration_instructions</span>
                        Integrations
                    </a>
                    <a href="#ar" class="nav-link flex items-center px-3 py-2 text-sm font-medium rounded-md {% if active_section == 'ar' %}bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100{% else %}text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700{% endif %} transition-colors">
                        <span class="material-icons text-lg mr-2">view_in_ar</span>
                        AR Settings
                    </a>
                </nav>
            </div>
        </div>
        
        <!-- Settings Content -->
        <div class="lg:col-span-3">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                <!-- General Settings -->
                <div id="general" class="settings-section p-6 {% if active_section != 'general' %}hidden{% endif %}">
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">General Settings</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm">Configure basic platform settings and preferences</p>
                    </div>
                    
                    <form method="post" action="/settings/general" class="space-y-6">
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <div>
                                <label for="site-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Site Title
                                    <span class="text-gray-400 text-xs ml-1">Platform name shown in header</span>
                                </label>
                                <input type="text" name="site-title" id="site-title" 
                                       value="{{ settings.general.site_title|default('Vertex AR B2B Platform') }}" 
                                       class="form-input" required>
                            </div>
                            
                            <div>
                                <label for="admin-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Admin Email
                                    <span class="text-gray-400 text-xs ml-1">Platform administrator email</span>
                                </label>
                                <input type="email" name="admin-email" id="admin-email" 
                                       value="{{ settings.general.admin_email|default('admin@vertexar.com') }}" 
                                       class="form-input" required>
                            </div>
                        </div>
                        
                        <div>
                            <label for="site-description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Site Description
                                <span class="text-gray-400 text-xs ml-1">Platform description for SEO and meta tags</span>
                            </label>
                            <textarea id="site-description" name="site-description" rows="3" 
                                      class="form-input">{{ settings.general.site_description|default('B2B SaaS platform for creating AR content based on image recognition (NFT markers)') }}</textarea>
                        </div>

                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <div>
                                <label for="timezone" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Timezone
                                </label>
                                <select id="timezone" name="timezone" class="form-select">
                                    <option value="UTC" {% if settings.general.timezone == 'UTC' %}selected{% endif %}>UTC</option>
                                    <option value="Europe/Moscow" {% if settings.general.timezone == 'Europe/Moscow' %}selected{% endif %}>Europe/Moscow</option>
                                    <option value="America/New_York" {% if settings.general.timezone == 'America/New_York' %}selected{% endif %}>America/New_York</option>
                                    <option value="Europe/London" {% if settings.general.timezone == 'Europe/London' %}selected{% endif %}>Europe/London</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="language" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Default Language
                                </label>
                                <select id="language" name="language" class="form-select">
                                    <option value="en" {% if settings.general.language == 'en' %}selected{% endif %}>English</option>
                                    <option value="ru" {% if settings.general.language == 'ru' %}selected{% endif %}>Russian</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label for="default-subscription-years" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Default Subscription Duration (years)
                            </label>
                            <input type="number" name="default-subscription-years" id="default-subscription-years" 
                                   value="{{ settings.general.default_subscription_years|default(1) }}" 
                                   min="1" max="10" class="form-input">
                        </div>
                        
                        <div class="flex items-center p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800">
                            <input id="maintenance-mode" name="maintenance-mode" type="checkbox" 
                                   {% if settings.general.maintenance_mode %}checked{% endif %}
                                   class="h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded">
                            <label for="maintenance-mode" class="ml-3 block text-sm text-gray-900 dark:text-white">
                                <span class="font-medium">Maintenance Mode</span>
                                <span class="text-gray-500 dark:text-gray-400 block">Temporarily disable public access to the platform</span>
                            </label>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                            <button type="button" onclick="window.location.reload()" 
                                    class="px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <span class="material-icons text-sm mr-1">save</span>
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Security Settings -->
                <div id="security" class="settings-section p-6 {% if active_section != 'security' %}hidden{% endif %}">
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Security Settings</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm">Configure security policies and access controls</p>
                    </div>
                    
                    <form method="post" action="/settings/security" class="space-y-6">
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <div>
                                <label for="password-min-length" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Minimum Password Length
                                </label>
                                <input type="number" name="password-min-length" id="password-min-length" 
                                       value="{{ settings.security.password_min_length|default(8) }}" 
                                       min="6" max="50" class="form-input">
                            </div>
                            
                            <div>
                                <label for="session-timeout" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Session Timeout (minutes)
                                </label>
                                <input type="number" name="session-timeout" id="session-timeout" 
                                       value="{{ settings.security.session_timeout|default(60) }}" 
                                       min="5" max="1440" class="form-input">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <div>
                                <label for="max-login-attempts" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Max Login Attempts
                                </label>
                                <input type="number" name="max-login-attempts" id="max-login-attempts" 
                                       value="{{ settings.security.max_login_attempts|default(5) }}" 
                                       min="3" max="20" class="form-input">
                            </div>
                            
                            <div>
                                <label for="lockout-duration" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Lockout Duration (seconds)
                                </label>
                                <input type="number" name="lockout-duration" id="lockout-duration" 
                                       value="{{ settings.security.lockout_duration|default(300) }}" 
                                       min="60" max="3600" class="form-input">
                            </div>
                        </div>
                        
                        <div>
                            <label for="api-rate-limit" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                API Rate Limit (requests per minute)
                            </label>
                            <input type="number" name="api-rate-limit" id="api-rate-limit" 
                                   value="{{ settings.security.api_rate_limit|default(100) }}" 
                                   min="10" max="1000" class="form-input">
                        </div>
                        
                        <div class="flex items-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                            <input id="require-2fa" name="require-2fa" type="checkbox" 
                                   {% if settings.security.require_2fa %}checked{% endif %}
                                   class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <label for="require-2fa" class="ml-3 block text-sm text-gray-900 dark:text-white">
                                <span class="font-medium">Require 2FA for all users</span>
                                <span class="text-gray-500 dark:text-gray-400 block">Enforce two-factor authentication for all admin accounts</span>
                            </label>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                            <button type="button" onclick="window.location.reload()" 
                                    class="px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <span class="material-icons text-sm mr-1">save</span>
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Storage Settings -->
                <div id="storage" class="settings-section p-6 {% if active_section != 'storage' %}hidden{% endif %}">
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Storage Settings</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm">Configure file storage and backup settings</p>
                    </div>
                    
                    <form method="post" action="/settings/storage" class="space-y-6">
                        <div>
                            <label for="default-storage" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Default Storage Provider
                            </label>
                            <select id="default-storage" name="default-storage" class="form-select">
                                <option value="local" {% if settings.storage.default_storage == 'local' %}selected{% endif %}>Local Storage</option>
                                <option value="aws" {% if settings.storage.default_storage == 'aws' %}selected{% endif %}>AWS S3</option>
                                <option value="gcp" {% if settings.storage.default_storage == 'gcp' %}selected{% endif %}>Google Cloud Storage</option>
                                <option value="azure" {% if settings.storage.default_storage == 'azure' %}selected{% endif %}>Azure Blob Storage</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="max-file-size" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Maximum File Size (MB)
                            </label>
                            <input type="number" name="max-file-size" id="max-file-size" 
                                   value="{{ settings.storage.max_file_size|default(100) }}" 
                                   min="1" max="1000" class="form-input">
                        </div>

                        <div>
                            <label for="cdn-url" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                CDN URL (optional)
                                <span class="text-gray-400 text-xs ml-1">Custom CDN for static files</span>
                            </label>
                            <input type="url" name="cdn-url" id="cdn-url" 
                                   value="{{ settings.storage.cdn_url|default('') }}" 
                                   placeholder="https://cdn.example.com" 
                                   class="form-input">
                        </div>

                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <div class="flex items-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                                <input id="cdn-enabled" name="cdn-enabled" type="checkbox" 
                                       {% if settings.storage.cdn_enabled %}checked{% endif %}
                                       class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded">
                                <label for="cdn-enabled" class="ml-3 block text-sm text-gray-900 dark:text-white">
                                    <span class="font-medium">Enable CDN</span>
                                    <span class="text-gray-500 dark:text-gray-400 block">Serve static files via CDN</span>
                                </label>
                            </div>
                            
                            <div class="flex items-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                                <input id="backup-enabled" name="backup-enabled" type="checkbox" 
                                       {% if settings.storage.backup_enabled %}checked{% endif %}
                                       class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded">
                                <label for="backup-enabled" class="ml-3 block text-sm text-gray-900 dark:text-white">
                                    <span class="font-medium">Enable Backups</span>
                                    <span class="text-gray-500 dark:text-gray-400 block">Automatic data backups</span>
                                </label>
                            </div>
                        </div>

                        <div>
                            <label for="backup-retention-days" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Backup Retention (days)
                            </label>
                            <input type="number" name="backup-retention-days" id="backup-retention-days" 
                                   value="{{ settings.storage.backup_retention_days|default(30) }}" 
                                   min="7" max="365" class="form-input">
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                            <button type="button" onclick="window.location.reload()" 
                                    class="px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <span class="material-icons text-sm mr-1">save</span>
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Notifications Settings -->
                <div id="notifications" class="settings-section p-6 {% if active_section != 'notifications' %}hidden{% endif %}">
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Notification Settings</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm">Configure email and Telegram notifications</p>
                    </div>
                    
                    <form method="post" action="/settings/notifications" class="space-y-6">
                        <!-- Email Settings -->
                        <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Email Notifications</h4>
                            
                            <div class="flex items-center mb-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                                <input id="email-enabled" name="email-enabled" type="checkbox" 
                                       {% if settings.notifications.email_enabled %}checked{% endif %}
                                       class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded">
                                <label for="email-enabled" class="ml-3 block text-sm text-gray-900 dark:text-white">
                                    <span class="font-medium">Enable Email Notifications</span>
                                    <span class="text-gray-500 dark:text-gray-400 block">Send system notifications via email</span>
                                </label>
                            </div>
                            
                            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                <div>
                                    <label for="smtp-host" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        SMTP Host
                                    </label>
                                    <input type="text" name="smtp-host" id="smtp-host" 
                                           value="{{ settings.notifications.smtp_host|default('') }}" 
                                           placeholder="smtp.gmail.com" 
                                           class="form-input">
                                </div>
                                
                                <div>
                                    <label for="smtp-port" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        SMTP Port
                                    </label>
                                    <input type="number" name="smtp-port" id="smtp-port" 
                                           value="{{ settings.notifications.smtp_port|default(587) }}" 
                                           min="1" max="65535" class="form-input">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 mt-4">
                                <div>
                                    <label for="smtp-username" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        SMTP Username
                                    </label>
                                    <input type="text" name="smtp-username" id="smtp-username" 
                                           value="{{ settings.notifications.smtp_username|default('') }}" 
                                           placeholder="your-email@gmail.com" 
                                           class="form-input">
                                </div>
                                
                                <div>
                                    <label for="smtp-from-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        From Email
                                    </label>
                                    <input type="email" name="smtp-from-email" id="smtp-from-email" 
                                           value="{{ settings.notifications.smtp_from_email|default('noreply@vertexar.com') }}" 
                                           class="form-input">
                                </div>
                            </div>
                        </div>

                        <!-- Telegram Settings -->
                        <div class="pb-6">
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Telegram Notifications</h4>
                            
                            <div class="flex items-center mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                                <input id="telegram-enabled" name="telegram-enabled" type="checkbox" 
                                       {% if settings.notifications.telegram_enabled %}checked{% endif %}
                                       class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <label for="telegram-enabled" class="ml-3 block text-sm text-gray-900 dark:text-white">
                                    <span class="font-medium">Enable Telegram Notifications</span>
                                    <span class="text-gray-500 dark:text-gray-400 block">Send alerts to Telegram chat</span>
                                </label>
                            </div>
                            
                            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                <div>
                                    <label for="telegram-bot-token" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Bot Token
                                    </label>
                                    <input type="password" name="telegram-bot-token" id="telegram-bot-token" 
                                           value="{{ settings.notifications.telegram_bot_token|default('') }}" 
                                           placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11" 
                                           class="form-input">
                                </div>
                                
                                <div>
                                    <label for="telegram-admin-chat-id" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Admin Chat ID
                                    </label>
                                    <input type="text" name="telegram-admin-chat-id" id="telegram-admin-chat-id" 
                                           value="{{ settings.notifications.telegram_admin_chat_id|default('') }}" 
                                           placeholder="-1001234567890" 
                                           class="form-input">
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                            <button type="button" onclick="window.location.reload()" 
                                    class="px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <span class="material-icons text-sm mr-1">save</span>
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>

                <!-- API Settings -->
                <div id="api" class="settings-section p-6 {% if active_section != 'api' %}hidden{% endif %}">
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">API Settings</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm">Configure API access and security</p>
                    </div>
                    
                    <form method="post" action="/settings/api" class="space-y-6">
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <div class="flex items-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                                <input id="api-keys-enabled" name="api-keys-enabled" type="checkbox" 
                                       {% if settings.api.api_keys_enabled %}checked{% endif %}
                                       class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded">
                                <label for="api-keys-enabled" class="ml-3 block text-sm text-gray-900 dark:text-white">
                                    <span class="font-medium">Enable API Keys</span>
                                    <span class="text-gray-500 dark:text-gray-400 block">Allow API key authentication</span>
                                </label>
                            </div>
                            
                            <div class="flex items-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                                <input id="documentation-public" name="documentation-public" type="checkbox" 
                                       {% if settings.api.documentation_public %}checked{% endif %}
                                       class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <label for="documentation-public" class="ml-3 block text-sm text-gray-900 dark:text-white">
                                    <span class="font-medium">Public Documentation</span>
                                    <span class="text-gray-500 dark:text-gray-400 block">API docs accessible without auth</span>
                                </label>
                            </div>
                        </div>

                        <div class="flex items-center p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800">
                            <input id="webhook-enabled" name="webhook-enabled" type="checkbox" 
                                   {% if settings.api.webhook_enabled %}checked{% endif %}
                                   class="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded">
                            <label for="webhook-enabled" class="ml-3 block text-sm text-gray-900 dark:text-white">
                                <span class="font-medium">Enable Webhooks</span>
                                <span class="text-gray-500 dark:text-gray-400 block">Send real-time event notifications</span>
                            </label>
                        </div>

                        <div>
                            <label for="webhook-url" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Webhook URL
                                <span class="text-gray-400 text-xs ml-1">Endpoint for webhook notifications</span>
                            </label>
                            <input type="url" name="webhook-url" id="webhook-url" 
                                   value="{{ settings.api.webhook_url|default('') }}" 
                                   placeholder="https://your-app.com/webhook" 
                                   class="form-input">
                        </div>
                        
                        <div>
                            <label for="cors-origins" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                CORS Origins
                                <span class="text-gray-400 text-xs ml-1">Comma-separated list of allowed origins</span>
                            </label>
                            <input type="text" name="cors-origins" id="cors-origins" 
                                   value="{{ settings.api.cors_origins|join(',') if settings.api.cors_origins else 'http://localhost:3000,http://localhost:8000' }}" 
                                   placeholder="http://localhost:3000,https://yourapp.com" 
                                   class="form-input">
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                            <button type="button" onclick="window.location.reload()" 
                                    class="px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <span class="material-icons text-sm mr-1">save</span>
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Integrations Settings -->
                <div id="integrations" class="settings-section p-6 {% if active_section != 'integrations' %}hidden{% endif %}">
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Integration Settings</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm">Configure third-party service integrations</p>
                    </div>
                    
                    <form method="post" action="/settings/integrations" class="space-y-6">
                        <!-- OAuth Settings -->
                        <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">OAuth Authentication</h4>
                            
                            <div class="flex items-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                                <input id="google-oauth-enabled" name="google-oauth-enabled" type="checkbox" 
                                       {% if settings.integrations.google_oauth_enabled %}checked{% endif %}
                                       class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <label for="google-oauth-enabled" class="ml-3 block text-sm text-gray-900 dark:text-white">
                                    <span class="font-medium">Enable Google OAuth</span>
                                    <span class="text-gray-500 dark:text-gray-400 block">Allow Google authentication</span>
                                </label>
                            </div>
                            
                            <div class="mt-4">
                                <label for="google-client-id" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Google Client ID
                                </label>
                                <input type="text" name="google-client-id" id="google-client-id" 
                                       value="{{ settings.integrations.google_client_id|default('') }}" 
                                       placeholder="your-google-client-id.apps.googleusercontent.com" 
                                       class="form-input">
                            </div>
                        </div>

                        <!-- Payment Settings -->
                        <div class="border-b border-gray-200 dark:border-gray-700 pb-6">
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Payment Processing</h4>
                            
                            <div>
                                <label for="payment-provider" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Payment Provider
                                </label>
                                <select id="payment-provider" name="payment-provider" class="form-select">
                                    <option value="stripe" {% if settings.integrations.payment_provider == 'stripe' %}selected{% endif %}>Stripe</option>
                                    <option value="paypal" {% if settings.integrations.payment_provider == 'paypal' %}selected{% endif %}>PayPal</option>
                                    <option value="yookassa" {% if settings.integrations.payment_provider == 'yookassa' %}selected{% endif %}>YooKassa</option>
                                </select>
                            </div>
                            
                            <div class="mt-4">
                                <label for="stripe-public-key" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Stripe Public Key
                                </label>
                                <input type="text" name="stripe-public-key" id="stripe-public-key" 
                                       value="{{ settings.integrations.stripe_public_key|default('') }}" 
                                       placeholder="pk_test_..." 
                                       class="form-input">
                            </div>
                        </div>

                        <!-- Analytics Settings -->
                        <div class="pb-6">
                            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Analytics & Monitoring</h4>
                            
                            <div class="flex items-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                                <input id="analytics-enabled" name="analytics-enabled" type="checkbox" 
                                       {% if settings.integrations.analytics_enabled %}checked{% endif %}
                                       class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded">
                                <label for="analytics-enabled" class="ml-3 block text-sm text-gray-900 dark:text-white">
                                    <span class="font-medium">Enable Analytics</span>
                                    <span class="text-gray-500 dark:text-gray-400 block">Track usage and performance metrics</span>
                                </label>
                            </div>
                            
                            <div class="mt-4">
                                <label for="analytics-provider" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Analytics Provider
                                </label>
                                <select id="analytics-provider" name="analytics-provider" class="form-select">
                                    <option value="google" {% if settings.integrations.analytics_provider == 'google' %}selected{% endif %}>Google Analytics</option>
                                    <option value="yandex" {% if settings.integrations.analytics_provider == 'yandex' %}selected{% endif %}>Yandex Metrica</option>
                                    <option value="plausible" {% if settings.integrations.analytics_provider == 'plausible' %}selected{% endif %}>Plausible</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                            <button type="button" onclick="window.location.reload()" 
                                    class="px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <span class="material-icons text-sm mr-1">save</span>
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>

                <!-- AR Settings -->
                <div id="ar" class="settings-section p-6 {% if active_section != 'ar' %}hidden{% endif %}">
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">AR Settings</h3>
                        <p class="text-gray-600 dark:text-gray-400 text-sm">Configure AR content processing and generation</p>
                    </div>
                    
                    <form method="post" action="/settings/ar" class="space-y-6">
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <div>
                                <label for="mindar-max-features" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    MindAR Max Features
                                    <span class="text-gray-400 text-xs ml-1">Maximum feature points for marker detection</span>
                                </label>
                                <input type="number" name="mindar-max-features" id="mindar-max-features" 
                                       value="{{ settings.ar.mindar_max_features|default(1000) }}" 
                                       min="100" max="5000" step="100" class="form-input">
                            </div>
                            
                            <div>
                                <label for="thumbnail-quality" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Thumbnail Quality (%)
                                    <span class="text-gray-400 text-xs ml-1">JPEG quality for generated thumbnails</span>
                                </label>
                                <input type="number" name="thumbnail-quality" id="thumbnail-quality" 
                                       value="{{ settings.ar.thumbnail_quality|default(80) }}" 
                                       min="10" max="100" step="5" class="form-input">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <div>
                                <label for="default-ar-viewer-theme" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Default AR Viewer Theme
                                </label>
                                <select id="default-ar-viewer-theme" name="default-ar-viewer-theme" class="form-select">
                                    <option value="default" {% if settings.ar.default_ar_viewer_theme == 'default' %}selected{% endif %}>Default</option>
                                    <option value="dark" {% if settings.ar.default_ar_viewer_theme == 'dark' %}selected{% endif %}>Dark</option>
                                    <option value="minimal" {% if settings.ar.default_ar_viewer_theme == 'minimal' %}selected{% endif %}>Minimal</option>
                                    <option value="corporate" {% if settings.ar.default_ar_viewer_theme == 'corporate' %}selected{% endif %}>Corporate</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="qr-code-expiration-days" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    QR Code Expiration (days)
                                    <span class="text-gray-400 text-xs ml-1">Default validity period for QR codes</span>
                                </label>
                                <input type="number" name="qr-code-expiration-days" id="qr-code-expiration-days" 
                                       value="{{ settings.ar.qr_code_expiration_days|default(365) }}" 
                                       min="30" max="1825" step="1" class="form-input">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <div class="flex items-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                                <input id="marker-generation-enabled" name="marker-generation-enabled" type="checkbox" 
                                       {% if settings.ar.marker_generation_enabled %}checked{% endif %}
                                       class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded">
                                <label for="marker-generation-enabled" class="ml-3 block text-sm text-gray-900 dark:text-white">
                                    <span class="font-medium">Enable Marker Generation</span>
                                    <span class="text-gray-500 dark:text-gray-400 block">Automatic MindAR marker creation</span>
                                </label>
                            </div>
                            
                            <div class="flex items-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                                <input id="video-processing-enabled" name="video-processing-enabled" type="checkbox" 
                                       {% if settings.ar.video_processing_enabled %}checked{% endif %}
                                       class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <label for="video-processing-enabled" class="ml-3 block text-sm text-gray-900 dark:text-white">
                                    <span class="font-medium">Enable Video Processing</span>
                                    <span class="text-gray-500 dark:text-gray-400 block">Background video optimization</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                            <button type="button" onclick="window.location.reload()" 
                                    class="px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <span class="material-icons text-sm mr-1">save</span>
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Settings navigation functionality
document.addEventListener('DOMContentLoaded', function() {
    const navLinks = document.querySelectorAll('.nav-link');
    const sections = document.querySelectorAll('.settings-section');
    
    // Handle navigation clicks
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            
            // Hide all sections
            sections.forEach(section => section.classList.add('hidden'));
            
            // Show target section
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Update active nav state
            navLinks.forEach(navLink => {
                navLink.classList.remove('bg-blue-100', 'text-blue-800', 'dark:bg-blue-900', 'dark:text-blue-100');
                navLink.classList.add('text-gray-700', 'dark:text-gray-300');
            });
            
            this.classList.remove('text-gray-700', 'dark:text-gray-300');
            this.classList.add('bg-blue-100', 'text-blue-800', 'dark:bg-blue-900', 'dark:text-blue-100');
        });
    });
    
    // Show active section based on hash or default
    const hash = window.location.hash.substring(1);
    const activeSection = hash || 'general';
    
    // Trigger click on active section
    const activeLink = document.querySelector(`.nav-link[href="#${activeSection}"]`);
    if (activeLink) {
        activeLink.click();
    }
    
    // Form submission loading states
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function() {
            const submitBtn = this.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="material-icons text-sm mr-1 animate-spin">refresh</span> Saving...';
            }
        });
    });
});

// Handle browser back/forward buttons
window.addEventListener('hashchange', function() {
    const hash = window.location.hash.substring(1);
    const activeLink = document.querySelector(`.nav-link[href="#${hash}"]`);
    if (activeLink) {
        activeLink.click();
    }
});
</script>
{% endblock %}