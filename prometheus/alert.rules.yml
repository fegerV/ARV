groups:
- name: vertex_ar_alerts
  rules:
  - alert: HighAPIResponseTime
    expr: api_request_duration_seconds{quantile="0.95"} > 5
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "High API latency (p95 > 5s)"

  - alert: High5xxErrors
    expr: sum(rate(api_request_count_total{status=~"5.."}[5m])) / sum(rate(api_request_count_total[5m])) * 100 > 5
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "High 5xx error rate (>5% of requests)"

  - alert: CeleryQueueBacklog
    expr: celery_queue_length > 100
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Celery queue backlog > 100 tasks"

  - alert: CeleryTaskFailures
    expr: increase(celery_task_failure_total[5m]) > 10
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "High Celery task failure rate (>10 failures in 5m)"

  - alert: PostgresHighConnections
    expr: pg_stat_activity_count > 80
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: "High PostgreSQL connections (>80)"
