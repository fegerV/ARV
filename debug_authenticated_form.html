<!DOCTYPE html>
<html lang="en" x-data x-init="$store.darkMode.init()" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create AR Content - Vertex AR Admin</title>
    
    <!-- Tailwind CSS from CDN with dark mode configuration -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', // Enable class-based dark mode
            theme: {
                extend: {}
            }
        }
    </script>
    
    <!-- htmx from CDN -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Alpine.js from CDN -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Alpine.js Inter from CDN -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/intersect@3.x/dist/cdn.min.js"></script>
    
    <!-- Alpine.js Focus from CDN -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/focus@3.x/dist/cdn.min.js"></script>
    
    <!-- Material Icons font -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- CSRF Token and htmx configuration -->
    <meta name="csrf-token" content="">
    <script>
      document.body.addEventListener('htmx:configRequest', (event) => {
        event.detail.headers['X-CSRF-Token'] = document.querySelector('meta[name="csrf-token"]').content;
      })
    </script>
    
    <style>
        [x-cloak] { display: none !important; }
        
        /* Custom styles for the admin interface */
        .sidebar-expanded {
            width: 240px;
        }
        
        .sidebar-collapsed {
            width: 64px;
        }
        
        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }
        
        /* Custom dark mode styles */
        .dark .bg-gray-50 {
            background-color: #111827;
        }
        
        .dark .text-gray-900 {
            color: #f9fafb;
        }
        
        /* Enhanced button styles */
        .btn {
            @apply inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500;
        }
        
        .btn-primary {
            @apply bg-indigo-600 hover:bg-indigo-700 focus:ring-indigo-500;
        }
        
        .btn-secondary {
            @apply bg-gray-600 hover:bg-gray-700 focus:ring-gray-500;
        }
        
        .btn-danger {
            @apply bg-red-600 hover:bg-red-700 focus:ring-red-500;
        }
        
        .btn-success {
            @apply bg-green-600 hover:bg-green-700 focus:ring-green-500;
        }
        
        /* Enhanced table styles */
        .table {
            @apply min-w-full divide-y divide-gray-200 dark:divide-gray-700;
        }
        
        .table thead {
            @apply bg-gray-50 dark:bg-gray-800;
        }
        
        .table th {
            @apply px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider;
        }
        
        .table td {
            @apply px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400;
        }
        
        /* Enhanced card styles */
        .card {
            @apply bg-white dark:bg-gray-800 shadow rounded-lg p-6;
        }
        
        /* Enhanced form styles */
        .form-input {
            @apply block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-indigo-50 focus:border-indigo-500 sm:text-sm dark:bg-gray-700 dark:text-white;
        }
        
        .form-select {
            @apply block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:ring-indigo-500 focus:border-indigo-50 sm:text-sm dark:bg-gray-700 dark:text-white;
        }
        
        /* Enhanced modal styles */
        .modal {
            @apply fixed inset-0 z-50 overflow-y-auto;
        }
        
        .modal-content {
            @apply inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full;
        }
        
        /* Enhanced toast styles */
        .toast {
            @apply text-white p-4 rounded shadow-lg mb-2 transition-opacity duration-300;
        }
    </style>
    
    
</head>
<body class="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-10">
    <!-- Include sidebar component -->
    <div x-data="sidebar()" id="sidebar" class="fixed top-0 left-0 h-screen bg-gray-800 dark:bg-gray-800 text-white w-64 z-10 transition-all duration-300">
    <div class="p-4 border-b border-gray-700 dark:border-gray-700">
        <h1 class="text-xl font-bold">Vertex AR</h1>
    </div>
    
    <div class="p-2">
        <ul class="space-y-1">
            <li>
                <a href="/admin" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/admin')}">
                    <span class="material-icons mr-3">dashboard</span>
                    <span class="sidebar-text">Dashboard</span>
                </a>
            </li>
            <li>
                <a href="/companies" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/companies')}">
                    <span class="material-icons mr-3">business</span>
                    <span class="sidebar-text">Companies</span>
                </a>
            </li>
            <li>
                <a href="/projects" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/projects')}">
                    <span class="material-icons mr-3">folder</span>
                    <span class="sidebar-text">Projects</span>
                </a>
            </li>
            <li>
                <a href="/ar-content" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/ar-content')}">
                    <span class="material-icons mr-3">view_in_ar</span>
                    <span class="sidebar-text">AR Content</span>
                </a>
            </li>
            <li>
                <a href="/storage" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/storage')}">
                    <span class="material-icons mr-3">storage</span>
                    <span class="sidebar-text">Storage</span>
                </a>
            </li>
            <li>
                <a href="/analytics" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/analytics')}">
                    <span class="material-icons mr-3">analytics</span>
                    <span class="sidebar-text">Analytics</span>
                </a>
            </li>
            <li>
                <a href="/notifications" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/notifications')}">
                    <span class="material-icons mr-3">notifications</span>
                    <span class="sidebar-text">Notifications</span>
                </a>
            </li>
            <li>
                <a href="/settings" class="nav-item flex items-center p-2 rounded hover:bg-gray-700 dark:hover:bg-gray-700 group" :class="{'bg-gray-700': isActive('/settings')}">
                    <span class="material-icons mr-3">settings</span>
                    <span class="sidebar-text">Settings</span>
                </a>
            </li>
        </ul>
    </div>
    
    <script>
        function sidebar() {
            return {
                isActive(route) {
                    return window.location.pathname === route;
                }
            }
        }
    </script>
</div>
    
    <!-- Main content area -->
    <div class="ml-64">
        <!-- Include header component -->
        <div x-data="sidebar()" class="fixed top-0 right-0 left-0 h-16 bg-white dark:bg-gray-800 shadow-md flex items-center px-4 z-10" :style="expanded ? 'margin-left: 240px' : 'margin-left: 64px'">
    <div class="flex items-center space-x-4">
        <button @click="toggle()" class="material-icons text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white">menu</button>
        <h2 class="text-lg font-semibold dark:text-white"></h2>
    </div>
    <div class="ml-auto flex items-center space-x-4">
        <div x-data>
            <button @click="$store.darkMode.toggle()" class="text-gray-600 hover:text-gray-700 dark:text-gray-300 dark:hover:text-white">
                <span class="material-icons" x-text="$store.darkMode.darkMode ? 'light_mode' : 'dark_mode'"></span>
            </button>
        </div>
        
        <span class="text-gray-600 dark:text-gray-300">Vertex AR Admin</span>
        <a href="/api/auth/logout" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">Выйти</a>
        
    </div>
</div>
        
        <!-- Main content -->
        <main class="pt-16 pb-8 p-4">
            
<div x-data="arContentForm({}, [{"contact_email": "admin@vertex.local", "created_at": "2025-12-29T16:13:21.066685", "id": 1, "name": "Vertex AR", "status": "active", "updated_at": "2025-12-29T16:13:21.066688"}], [{"company_id": 1, "created_at": "2025-12-29T16:15:45.718642", "description": null, "id": 1, "name": "\u041f\u043e\u0440\u0442\u0440\u0435\u0442\u044b", "status": "active", "updated_at": "2025-12-29T16:15:45.718644"}])">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
                Создать AR контент
            </h1>
            <a href="/ar-content" class="btn btn-secondary">
                <span class="material-icons mr-2">arrow_back</span>Назад
            </a>
        </div>

        <form @submit.prevent="handleSubmit" method="post" enctype="multipart/form-data" class="bg-white dark:bg-gray-800 shadow rounded-lg">
            <!-- Company & Project Selection -->
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Компания и проект</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="company_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Компания <span class="text-red-500">*</span>
                        </label>
                        <select name="company_id" id="company_id" 
                                class="form-input"
                                x-model="formData.company_id"
                                @change="updateProjects"
                                required>
                            <option value="">Выберите компанию</option>
                            
                            <option value="1">Vertex AR</option>
                            
                        </select>
                    </div>
                    
                    <div>
                        <label for="project_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Проект <span class="text-red-500">*</span>
                        </label>
                        <select name="project_id" id="project_id" 
                                class="form-input"
                                x-model="formData.project_id"
                                required>
                            <option value="">Выберите проект</option>
                            <template x-for="project in filteredProjects" :key="project.id">
                                <option :value="project.id" x-text="project.name"></option>
                            </template>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Customer Information -->
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Информация о заказчике</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="customer_name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Имя заказчика
                        </label>
                        <input type="text" name="customer_name" id="customer_name" 
                               class="form-input"
                               x-model="formData.customer_name"
                               placeholder="Имя Фамилия">
                    </div>
                    
                    <div>
                        <label for="customer_phone" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Телефон
                        </label>
                        <input type="tel" name="customer_phone" id="customer_phone" 
                               class="form-input"
                               x-model="formData.customer_phone"
                               placeholder="+7 (999) 123-45-67">
                    </div>
                    
                    <div>
                        <label for="customer_email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Email
                        </label>
                        <input type="email" name="customer_email" id="customer_email" 
                               class="form-input"
                               x-model="formData.customer_email"
                               placeholder="customer@example.com">
                    </div>
                </div>
            </div>

            <!-- Duration -->
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Длительность доступа</h3>
                <div>
                    <label for="duration_years" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Период действия <span class="text-red-500">*</span>
                    </label>
                    <select name="duration_years" id="duration_years" 
                            class="form-input"
                            x-model="formData.duration_years"
                            required>
                        <option value="1">1 год</option>
                        <option value="3">3 года</option>
                        <option value="5">5 лет</option>
                    </select>
                </div>
            </div>

            <!-- File Upload -->
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Файлы контента</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Портрет (изображение) <span class="text-red-500">*</span>
                        </label>
                        <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-md hover:border-gray-400 dark:hover:border-gray-500 transition-colors">
                            <div class="space-y-1 text-center">
                                <div x-show="!photoPreview" class="text-gray-400">
                                    <span class="material-icons text-4xl mb-2">image</span>
                                </div>
                                <img x-show="photoPreview" :src="photoPreview" class="mx-auto h-32 w-32 object-cover rounded">
                                <div class="flex text-sm text-gray-600 dark:text-gray-400">
                                    <label for="photo_file" class="relative cursor-pointer rounded-md font-medium text-indigo-600 hover:text-indigo-500 dark:text-indigo-400 dark:hover:text-indigo-300">
                                        <span x-show="!photoPreview">Выберите файл</span>
                                        <span x-show="photoPreview">Изменить файл</span>
                                        <input id="photo_file" name="photo_file" type="file" class="sr-only" accept="image/*" @change="handlePhotoChange">
                                    </label>
                                    <p class="pl-1" x-show="!photoPreview">или перетащите сюда</p>
                                </div>
                                <p class="text-xs text-gray-500 dark:text-gray-400">
                                    PNG, JPG до 10MB
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Видео <span class="text-red-500">*</span>
                        </label>
                        <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-md hover:border-gray-400 dark:hover:border-gray-500 transition-colors">
                            <div class="space-y-1 text-center">
                                <div x-show="!videoFile" class="text-gray-400">
                                    <span class="material-icons text-4xl mb-2">videocam</span>
                                </div>
                                <div x-show="videoFile" class="text-center">
                                    <span class="material-icons text-4xl mb-2 text-green-500">check_circle</span>
                                    <p class="text-sm text-gray-600 dark:text-gray-400" x-text="videoFile.name"></p>
                                </div>
                                <div class="flex text-sm text-gray-600 dark:text-gray-400">
                                    <label for="video_file" class="relative cursor-pointer rounded-md font-medium text-indigo-600 hover:text-indigo-500 dark:text-indigo-400 dark:hover:text-indigo-300">
                                        <span x-show="!videoFile">Выберите файл</span>
                                        <span x-show="videoFile">Изменить файл</span>
                                        <input id="video_file" name="video_file" type="file" class="sr-only" accept="video/*" @change="handleVideoChange">
                                    </label>
                                    <p class="pl-1" x-show="!videoFile">или перетащите сюда</p>
                                </div>
                                <p class="text-xs text-gray-50 dark:text-gray-400">
                                    MP4, WebM, MOV до 100MB
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status (only for edit) -->
            <div class="p-6 border-b border-gray-200 dark:border-gray-700" x-show="arContent && arContent.id">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Статус</h3>
                <div>
                    <label for="status" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Статус заказа
                    </label>
                    <select name="status" id="status" 
                            class="form-input"
                            x-model="formData.status">
                        <option value="pending">В ожидании</option>
                        <option value="processing">В обработке</option>
                        <option value="ready">Готов</option>
                        <option value="failed">Ошибка</option>
                    </select>
                </div>
            </div>

            <!-- Actions -->
            <div class="p-6 bg-gray-50 dark:bg-gray-700 rounded-b-lg">
                <div class="flex justify-end space-x-3">
                    <a href="/ar-content" class="btn btn-secondary">
                        Отмена
                    </a>
                    <button type="submit" 
                            :disabled="!isValid || submitting"
                            :class="{'opacity-50 cursor-not-allowed': !isValid || submitting}"
                            class="btn btn-primary">
                        <span class="material-icons mr-2" x-show="!submitting">save</span>
                        <span class="material-icons mr-2 animate-spin" x-show="submitting">refresh</span>
                        <span x-show="!submitting">Создать AR контент</span>
                        <span x-show="submitting">Сохранение...</span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
function arContentForm(arContent = {}, companies = [], projects = []) {
    return {
        arContent: arContent,
        companies: companies,
        projects: projects,
        submitting: false,
        formData: {
            company_id: arContent.company_id || '',
            project_id: arContent.project_id || '',
            customer_name: arContent.customer_name || '',
            customer_phone: arContent.customer_phone || '',
            customer_email: arContent.customer_email || '',
            duration_years: arContent.duration_years || '1',
            photo_file: null,
            video_file: null,
            status: arContent.status || 'pending'
        },
        
        get filteredProjects() {
            if (!this.formData.company_id) return [];
            return this.projects.filter(project =>
                project.company_id &&
                this.formData.company_id &&
                String(project.company_id) === String(this.formData.company_id)
            );
        },
        
        get photoPreview() {
            return this.formData.photo_file ? URL.createObjectURL(this.formData.photo_file) : (this.arContent.photo_url || null);
        },
        
        get videoFile() {
            return this.formData.video_file;
        },
        
        get isValid() {
            return this.formData.company_id && 
                   this.formData.project_id && 
                   this.formData.customer_name && 
                   this.formData.duration_years && 
                   this.formData.photo_file && 
                   this.formData.video_file;
        },
        
        updateProjects() {
            // Reset project selection when company changes
            this.formData.project_id = '';
        },
        
        handlePhotoChange(event) {
            const file = event.target.files[0];
            if (file) {
                if (!file.type.startsWith('image/')) {
                    this.showToast('Пожалуйста, выберите изображение', 'error');
                    event.target.value = '';
                    return;
                }
                if (file.size > 10 * 1024 * 1024) {
                    this.showToast('Размер файла не должен превышать 10MB', 'error');
                    event.target.value = '';
                    return;
                }
                this.formData.photo_file = file;
            }
        },
        
        handleVideoChange(event) {
            const file = event.target.files[0];
            if (file) {
                if (!file.type.startsWith('video/')) {
                    this.showToast('Пожалуйста, выберите видеофайл', 'error');
                    event.target.value = '';
                    return;
                }
                if (file.size > 100 * 1024 * 1024) {
                    this.showToast('Размер файла не должен превышать 100MB', 'error');
                    event.target.value = '';
                    return;
                }
                this.formData.video_file = file;
            }
        },
        
        async handleSubmit() {
            if (!this.isValid) {
                this.showToast('Пожалуйста, заполните все обязательные поля', 'error');
                return;
            }
            
            this.submitting = true;
            
            try {
                const formData = new FormData();
                formData.append('company_id', this.formData.company_id);
                formData.append('project_id', this.formData.project_id);
                formData.append('customer_name', this.formData.customer_name);
                formData.append('customer_phone', this.formData.customer_phone);
                formData.append('customer_email', this.formData.customer_email);
                formData.append('duration_years', this.formData.duration_years);
                formData.append('photo_file', this.formData.photo_file);
                formData.append('video_file', this.formData.video_file);
                
                if (this.arContent && this.arContent.id) {
                    // Update existing AR content
                    formData.append('_method', 'PUT');
                    
                    const response = await fetch(`/companies/${this.formData.company_id}/projects/${this.formData.project_id}/ar-content/${this.arContent.id}`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (response.ok) {
                        this.showToast('AR контент успешно обновлен', 'success');
                        window.location.href = `/ar-content/${this.arContent.id}`;
                    } else {
                        throw new Error('Update failed');
                    }
                } else {
                    // Create new AR content
                    const response = await fetch(`/companies/${this.formData.company_id}/projects/${this.formData.project_id}/ar-content`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        this.showToast('AR контент успешно создан', 'success');
                        window.location.href = `/ar-content/${result.id}`;
                    } else {
                        throw new Error('Create failed');
                    }
                }
            } catch (error) {
                this.showToast('Не удалось сохранить AR контент', 'error');
                console.error('Submit error:', error);
            } finally {
                this.submitting = false;
            }
        },
        
        showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            toast.className = `fixed bottom-4 right-4 ${bgColor} text-white px-4 py-2 rounded shadow z-50`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 3000);
        }
    }
}
</script>

        </main>
    </div>
    
    <!-- Include toast component -->
    <!-- Toast Notification System -->
<div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>
    
    <!-- Include modal component -->
    <!-- Modal System -->
<div id="modal-container" class="fixed inset-0 z-50 overflow-y-auto" style="display: none;">
    <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 transition-opacity" aria-hidden="true">
            <div class="absolute inset-0 bg-gray-500 opacity-75" onclick="closeModal()"></div>
        </div>
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
        <div id="modal-content" class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <div id="modal-body" class="p-6"></div>
            <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button type="button" class="btn btn-primary" onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>
</div>
    
    <script>
        // Initialize Alpine.js stores
        document.addEventListener('alpine:init', () => {
            Alpine.store('darkMode', {
                darkMode: localStorage.getItem('darkMode') === 'true',
                
                init() {
                    if (this.darkMode) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                },
                
                toggle() {
                    this.darkMode = !this.darkMode;
                    localStorage.setItem('darkMode', this.darkMode);
                    if (this.darkMode) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                }
            });
        });
        
        // Dark mode functionality (for backward compatibility)
        function darkMode() {
            return {
                get darkMode() {
                    return Alpine.store('darkMode').darkMode;
                },
                
                init() {
                    // Initialize from store
                    if (Alpine.store('darkMode').darkMode) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                },
                
                toggle() {
                    Alpine.store('darkMode').toggle();
                }
            }
        }
        
        // Sidebar functionality
        function sidebar() {
            return {
                expanded: true,
                
                init() {
                    // Initialize sidebar state
                    this.expanded = localStorage.getItem('sidebarExpanded') !== 'false';
                },
                
                toggle() {
                    this.expanded = !this.expanded;
                    localStorage.setItem('sidebarExpanded', this.expanded);
                    
                    const sidebar = document.getElementById('sidebar');
                    const mainContent = document.querySelector('.ml-64');
                    
                    if (this.expanded) {
                        sidebar.classList.remove('sidebar-collapsed');
                        sidebar.classList.add('sidebar-expanded');
                        mainContent.classList.remove('ml-16');
                        mainContent.classList.add('ml-64');
                    } else {
                        sidebar.classList.remove('sidebar-expanded');
                        sidebar.classList.add('sidebar-collapsed');
                        mainContent.classList.remove('ml-64');
                        mainContent.classList.add('ml-16');
                    }
                },
                
                isActive(path) {
                    return window.location.pathname.startsWith(path);
                }
            }
        }
        
        // Toast notification functions
        function showToast(message, type = 'info') {
            const toastId = 'toast-' + Date.now();
            const toastClass = type === 'error' ? 'bg-red-500' : 
                              type === 'success' ? 'bg-green-500' : 
                              type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';
            
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `toast ${toastClass} text-white p-4 rounded shadow-lg mb-2 transition-opacity duration-300`;
            toast.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="removeToast('${toastId}')" class="ml-4 text-white">×</button>
                </div>
            `;
            
            document.getElementById('toast-container').appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                removeToast(toastId);
            }, 5000);
        }
        
        function removeToast(toastId) {
            const toast = document.getElementById(toastId);
            if (toast) {
                toast.style.opacity = '0';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }
        }
        
        // Modal functions
        function showModal(content) {
            document.getElementById('modal-body').innerHTML = content;
            document.getElementById('modal-container').style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('modal-container').style.display = 'none';
        }
        
        // Form submission with htmx
        function submitForm(url, data, method = 'POST') {
            const element = document.createElement('div');
            element.setAttribute('hx-' + method.toLowerCase(), url);
            element.setAttribute('hx-headers', JSON.stringify(data));
            element.setAttribute('hx-target', 'body');
            element.setAttribute('hx-swap', 'innerHTML');
            
            htmx.process(element);
            element.click();
        }
        
        // Delete confirmation
        function confirmDelete(url) {
            if (confirm('Are you sure you want to delete this item? This action cannot be undone.')) {
                window.location.href = url;
            }
        }
    </script>
    
    
</body>
</html>